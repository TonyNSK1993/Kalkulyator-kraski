<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Инженерный помощник НЗСК | Расчет расхода огнезащитных материалов</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    :root {
      --nzsk-yellow: #ffc107;
      --nzsk-yellow-light: #fff3cd;
      --nzsk-yellow-dark: #e0a800;
      --nzsk-black: #212529;
      --nzsk-white: #ffffff;
      --nzsk-gray-light: #f8f9fa;
      --nzsk-gray: #e9ecef;
      --nzsk-gray-dark: #6c757d;
      --danger: #dc3545;
      --warning: #fd7e14;
      --success: #28a745;
      --info: #17a2b8;
      --shadow-sm: 0 1px 3px rgba(0,0,0,0.1);
      --shadow-md: 0 4px 12px rgba(0,0,0,0.1);
      --shadow-lg: 0 10px 25px rgba(0,0,0,0.1);
      --radius-sm: 8px;
      --radius-md: 12px;
      --radius-lg: 16px;
      --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Segoe UI', system-ui, -apple-system, sans-serif;
      background: linear-gradient(135deg, #ffffff 0%, #f8f9fa 100%);
      color: #343a40;
      line-height: 1.6;
      min-height: 100vh;
      padding: 20px;
    }

    .container {
      max-width: 1400px;
      margin: 0 auto;
    }

    /* Шапка */
    .header {
      background: var(--nzsk-white);
      color: var(--nzsk-black);
      padding: 25px 30px;
      border-radius: var(--radius-lg) var(--radius-lg) 0 0;
      position: relative;
      overflow: hidden;
      display: flex;
      justify-content: space-between;
      align-items: center;
      border-bottom: 3px solid var(--nzsk-yellow);
      box-shadow: var(--shadow-sm);
    }

    .header::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 3px;
      background: var(--nzsk-yellow);
      z-index: 2;
    }

    .logo {
      display: flex;
      align-items: center;
      gap: 15px;
      position: relative;
      z-index: 1;
    }

    .logo-icon {
      background: var(--nzsk-yellow);
      width: 50px;
      height: 50px;
      border-radius: 12px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 24px;
      color: var(--nzsk-black);
      box-shadow: 0 4px 8px rgba(255, 193, 7, 0.3);
    }

    .logo-text h1 {
      font-size: 24px;
      font-weight: 700;
      margin-bottom: 5px;
      color: var(--nzsk-black);
    }

    .logo-text p {
      font-size: 14px;
      color: var(--nzsk-gray-dark);
    }

    .status-indicator {
      display: flex;
      align-items: center;
      gap: 8px;
      font-size: 14px;
      color: var(--nzsk-black);
      position: relative;
      z-index: 1;
    }

    .status-dot {
      width: 10px;
      height: 10px;
      border-radius: 50%;
      background: var(--success);
      animation: pulse 2s infinite;
    }

    @keyframes pulse {
      0% { opacity: 1; }
      50% { opacity: 0.5; }
      100% { opacity: 1; }
    }

    /* Основная карточка */
    .main-card {
      background: var(--nzsk-white);
      border-radius: 0 0 var(--radius-lg) var(--radius-lg);
      box-shadow: var(--shadow-lg);
      overflow: hidden;
      margin-bottom: 30px;
      border: 1px solid var(--nzsk-gray);
    }

    /* Навигация */
    .tabs {
      display: flex;
      background: var(--nzsk-gray-light);
      border-bottom: 3px solid var(--nzsk-yellow);
      overflow-x: auto;
    }

    .tab {
      flex: none;
      padding: 20px 25px;
      text-align: center;
      background: none;
      border: none;
      font-size: 15px;
      font-weight: 600;
      color: var(--nzsk-gray-dark);
      cursor: pointer;
      transition: var(--transition);
      position: relative;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
      white-space: nowrap;
    }

    .tab:hover {
      background: rgba(255, 193, 7, 0.1);
      color: var(--nzsk-black);
    }

    .tab.active {
      background: var(--nzsk-white);
      color: var(--nzsk-black);
    }

    .tab.active::before {
      content: '';
      position: absolute;
      top: -3px;
      left: 0;
      right: 0;
      height: 3px;
      background: var(--nzsk-yellow);
    }

    .tab i {
      font-size: 16px;
    }

    .tab-content {
      display: none;
      padding: 30px;
    }

    .tab-content.active {
      display: block;
      animation: fadeIn 0.4s ease;
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }

    /* Основное содержимое - два столбца */
    .content-wrapper {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 30px;
      margin-top: 20px;
    }

    @media (max-width: 1024px) {
      .content-wrapper {
        grid-template-columns: 1fr;
      }
    }

    /* Левая колонка - форма */
    .form-column {
      background: var(--nzsk-gray-light);
      padding: 25px;
      border-radius: var(--radius-md);
      border: 1px solid var(--nzsk-gray);
      box-shadow: var(--shadow-sm);
    }

    /* Правая колонка - результаты */
    .results-column {
      background: var(--nzsk-gray-light);
      padding: 25px;
      border-radius: var(--radius-md);
      border: 1px solid var(--nzsk-gray);
      box-shadow: var(--shadow-sm);
      max-height: 700px;
      overflow-y: auto;
    }

    /* Секции */
    .section {
      margin-bottom: 25px;
    }

    .section-header {
      display: flex;
      align-items: center;
      margin-bottom: 20px;
      padding-bottom: 15px;
      border-bottom: 2px solid var(--nzsk-gray);
    }

    .section-icon {
      background: linear-gradient(135deg, var(--nzsk-yellow) 0%, var(--nzsk-yellow-dark) 100%);
      color: var(--nzsk-black);
      width: 40px;
      height: 40px;
      border-radius: 10px;
      display: flex;
      align-items: center;
      justify-content: center;
      margin-right: 15px;
      font-size: 18px;
      box-shadow: 0 4px 8px rgba(255, 193, 7, 0.3);
    }

    .section-title {
      font-size: 18px;
      font-weight: 700;
      color: var(--nzsk-black);
    }

    .section-subtitle {
      font-size: 14px;
      color: var(--nzsk-gray-dark);
      margin-top: 4px;
    }

    /* Формы */
    .form-group {
      margin-bottom: 20px;
      position: relative;
    }

    .form-label {
      display: block;
      margin-bottom: 8px;
      font-weight: 600;
      color: var(--nzsk-black);
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .form-label i {
      color: var(--nzsk-yellow-dark);
      width: 20px;
    }

    .form-control {
      width: 100%;
      padding: 14px 16px;
      border: 2px solid var(--nzsk-gray);
      border-radius: var(--radius-sm);
      font-size: 15px;
      transition: var(--transition);
      background: var(--nzsk-white);
      color: var(--nzsk-black);
    }

    .form-control:focus {
      outline: none;
      border-color: var(--nzsk-yellow);
      box-shadow: 0 0 0 3px rgba(255, 193, 7, 0.2);
    }

    .form-control.error {
      border-color: var(--danger);
      background: #fff5f5;
    }

    /* Кастомный select */
    .custom-select {
      position: relative;
      width: 100%;
    }

    .custom-select-btn {
      width: 100%;
      padding: 14px 16px;
      border: 2px solid var(--nzsk-gray);
      border-radius: var(--radius-sm);
      font-size: 15px;
      transition: var(--transition);
      background: var(--nzsk-white);
      color: var(--nzsk-black);
      text-align: left;
      cursor: pointer;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .custom-select-btn:hover {
      border-color: var(--nzsk-yellow);
    }

    .custom-select-btn:focus {
      outline: none;
      border-color: var(--nzsk-yellow);
      box-shadow: 0 0 0 3px rgba(255, 193, 7, 0.2);
    }

    .custom-select-btn i {
      color: var(--nzsk-gray-dark);
      transition: transform 0.3s ease;
    }

    .custom-select-btn.open i {
      transform: rotate(180deg);
    }

    .custom-select-dropdown {
      position: absolute;
      top: 100%;
      left: 0;
      right: 0;
      background: var(--nzsk-white);
      border: 2px solid var(--nzsk-yellow);
      border-radius: var(--radius-sm);
      margin-top: 5px;
      max-height: 300px;
      overflow-y: auto;
      z-index: 100;
      box-shadow: var(--shadow-lg);
      display: none;
    }

    .custom-select-dropdown.open {
      display: block;
      animation: fadeIn 0.2s ease;
    }

    .custom-select-option {
      padding: 14px 16px;
      color: var(--nzsk-black);
      cursor: pointer;
      transition: var(--transition);
      border-bottom: 1px solid var(--nzsk-gray);
    }

    .custom-select-option:last-child {
      border-bottom: none;
    }

    .custom-select-option:hover {
      background: var(--nzsk-yellow-light);
    }

    .custom-select-option.selected {
      background: var(--nzsk-yellow);
      color: var(--nzsk-black);
      font-weight: 600;
    }

    .error-message {
      color: var(--danger);
      font-size: 13px;
      margin-top: 5px;
      display: flex;
      align-items: center;
      gap: 5px;
    }

    /* Подсказки */
    .hint-box {
      background: var(--nzsk-yellow-light);
      border-left: 4px solid var(--nzsk-yellow);
      padding: 15px;
      border-radius: var(--radius-sm);
      margin: 15px 0;
      font-size: 14px;
      color: var(--nzsk-black);
    }

    .hint-box.warning {
      background: #fff3cd;
      border-left-color: var(--warning);
      color: #856404;
    }

    .hint-box.warning i {
      color: var(--warning);
    }

    .hint-box.danger {
      background: #f8d7da;
      border-left-color: var(--danger);
      color: #721c24;
    }

    .hint-box.danger i {
      color: var(--danger);
    }

    .hint-box.success {
      background: #d4edda;
      border-left-color: var(--success);
      color: #155724;
    }

    .hint-box.success i {
      color: var(--success);
    }

    /* Кнопки */
    .button-group {
      display: flex;
      gap: 15px;
      margin: 25px 0;
    }

    .btn {
      padding: 15px 25px;
      border: none;
      border-radius: var(--radius-sm);
      font-size: 15px;
      font-weight: 600;
      cursor: pointer;
      transition: var(--transition);
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
      flex: 1;
    }

    .btn-primary {
      background: linear-gradient(135deg, var(--nzsk-yellow) 0%, var(--nzsk-yellow-dark) 100%);
      color: var(--nzsk-black);
      box-shadow: 0 4px 8px rgba(255, 193, 7, 0.2);
    }

    .btn-primary:hover {
      background: linear-gradient(135deg, var(--nzsk-yellow-dark) 0%, var(--nzsk-yellow) 100%);
      transform: translateY(-2px);
      box-shadow: 0 8px 20px rgba(255, 193, 7, 0.3);
    }

    .btn-secondary {
      background: var(--nzsk-white);
      color: var(--nzsk-black);
      border: 2px solid var(--nzsk-yellow);
      box-shadow: 0 4px 8px rgba(0,0,0,0.05);
    }

    .btn-secondary:hover {
      background: var(--nzsk-yellow);
      transform: translateY(-2px);
      box-shadow: 0 8px 20px rgba(255, 193, 7, 0.2);
    }

    .btn-outline {
      background: var(--nzsk-white);
      color: var(--nzsk-gray-dark);
      border: 2px solid var(--nzsk-gray);
      box-shadow: 0 4px 8px rgba(0,0,0,0.05);
    }

    .btn-outline:hover {
      background: var(--nzsk-gray);
      color: var(--nzsk-black);
      transform: translateY(-2px);
    }

    .btn:disabled {
      opacity: 0.6;
      cursor: not-allowed;
      transform: none !important;
    }

    /* Результаты */
    .results-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 20px;
      padding-bottom: 15px;
      border-bottom: 2px solid var(--nzsk-gray);
    }

    .results-title {
      display: flex;
      align-items: center;
      gap: 12px;
      font-size: 18px;
      font-weight: 700;
      color: var(--nzsk-black);
    }

    .status-badge {
      padding: 6px 15px;
      border-radius: 20px;
      font-size: 12px;
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .status-success {
      background: #d4edda;
      color: var(--success);
      border: 1px solid #c3e6cb;
    }

    .status-warning {
      background: #fff3cd;
      color: #856404;
      border: 1px solid #ffeaa7;
    }

    .status-error {
      background: #f8d7da;
      color: var(--danger);
      border: 1px solid #f5c6cb;
    }

    .status-info {
      background: #d1ecf1;
      color: #0c5460;
      border: 1px solid #bee5eb;
    }

    /* Яркая красная подсветка для несовместимости */
    .incompatible-highlight {
      background: #f8d7da;
      border: 2px solid var(--danger);
      padding: 15px;
      border-radius: var(--radius-sm);
      margin: 15px 0;
      animation: pulse-red 2s infinite;
    }

    @keyframes pulse-red {
      0% { box-shadow: 0 0 0 0 rgba(220, 53, 69, 0.4); }
      70% { box-shadow: 0 0 0 10px rgba(220, 53, 69, 0); }
      100% { box-shadow: 0 0 0 0 rgba(220, 53, 69, 0); }
    }

    .result-item {
      margin-bottom: 20px;
      padding: 15px;
      border-radius: var(--radius-sm);
      background: var(--nzsk-white);
      border-left: 4px solid var(--nzsk-yellow);
      box-shadow: var(--shadow-sm);
    }

    .result-item.success {
      background: #d4edda;
      border-left-color: var(--success);
    }

    .result-item.warning {
      background: #fff3cd;
      border-left-color: var(--warning);
    }

    .result-item.error {
      background: #f8d7da;
      border-left-color: var(--danger);
    }

    .result-icon {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      width: 24px;
      height: 24px;
      border-radius: 50%;
      margin-right: 10px;
      font-size: 12px;
    }

    .result-icon.success {
      background: rgba(40, 167, 69, 0.2);
      color: var(--success);
    }

    .result-icon.warning {
      background: rgba(253, 126, 20, 0.2);
      color: var(--warning);
    }

    .result-icon.error {
      background: rgba(220, 53, 69, 0.2);
      color: var(--danger);
    }

    .result-icon.info {
      background: rgba(23, 162, 184, 0.2);
      color: var(--info);
    }

    /* Информационные карточки */
    .info-cards {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
      gap: 15px;
      margin: 20px 0;
    }

    .info-card {
      background: var(--nzsk-white);
      padding: 20px;
      border-radius: var(--radius-sm);
      border: 1px solid var(--nzsk-gray);
      text-align: center;
      transition: var(--transition);
      box-shadow: var(--shadow-sm);
    }

    .info-card:hover {
      transform: translateY(-3px);
      box-shadow: var(--shadow-md);
      border-color: var(--nzsk-yellow);
    }

    .info-card-title {
      font-size: 13px;
      color: var(--nzsk-gray-dark);
      text-transform: uppercase;
      letter-spacing: 0.5px;
      margin-bottom: 8px;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
    }

    .info-card-value {
      font-size: 24px;
      font-weight: 800;
      color: var(--nzsk-yellow-dark);
      margin: 5px 0;
    }

    .info-card-unit {
      font-size: 14px;
      color: var(--nzsk-gray-dark);
    }

    /* Прогресс-бары */
    .progress-container {
      margin: 20px 0;
    }

    .progress-label {
      display: flex;
      justify-content: space-between;
      margin-bottom: 8px;
      font-size: 14px;
      font-weight: 600;
      color: var(--nzsk-black);
    }

    .progress-bar {
      height: 10px;
      background: var(--nzsk-gray);
      border-radius: 5px;
      overflow: hidden;
    }

    .progress-fill {
      height: 100%;
      background: linear-gradient(90deg, var(--nzsk-yellow) 0%, var(--nzsk-yellow-dark) 100%);
      border-radius: 5px;
      transition: width 1s ease;
    }

    /* Таймер */
    .timer-container {
      background: var(--nzsk-white);
      border-radius: var(--radius-md);
      padding: 20px;
      margin: 20px 0;
      border: 1px solid var(--nzsk-yellow);
      box-shadow: var(--shadow-sm);
    }

    .timer-display {
      text-align: center;
    }

    .timer-title {
      font-size: 16px;
      font-weight: 600;
      margin-bottom: 15px;
      color: var(--nzsk-black);
    }

    .timer-clock {
      font-size: 42px;
      font-weight: 700;
      font-family: 'Courier New', monospace;
      color: var(--nzsk-yellow-dark);
      margin: 15px 0;
      letter-spacing: 2px;
    }

    /* История */
    .history-item {
      padding: 15px;
      border-radius: var(--radius-sm);
      background: var(--nzsk-white);
      border-left: 4px solid var(--nzsk-yellow);
      margin-bottom: 10px;
      box-shadow: var(--shadow-sm);
      transition: var(--transition);
    }

    .history-item:hover {
      transform: translateX(5px);
      box-shadow: var(--shadow-md);
    }

    .history-date {
      font-size: 12px;
      color: var(--nzsk-gray-dark);
      margin-bottom: 5px;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .history-product {
      font-weight: 600;
      color: var(--nzsk-black);
      margin-bottom: 5px;
    }

    /* Специальные стили для калькулятора */
    .input-group-row {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 15px;
      margin-bottom: 15px;
    }

    .calculator-tabs {
      display: flex;
      margin-bottom: 20px;
      border-bottom: 2px solid var(--nzsk-gray);
    }

    .calc-tab {
      padding: 12px 20px;
      background: none;
      border: none;
      border-bottom: 3px solid transparent;
      font-weight: 600;
      color: var(--nzsk-gray-dark);
      cursor: pointer;
      transition: var(--transition);
    }

    .calc-tab:hover {
      color: var(--nzsk-black);
    }

    .calc-tab.active {
      color: var(--nzsk-black);
      border-bottom-color: var(--nzsk-yellow);
      background: var(--nzsk-yellow-light);
    }

    .calc-content {
      display: none;
    }

    .calc-content.active {
      display: block;
    }

    .size-table {
      width: 100%;
      border-collapse: collapse;
      margin: 15px 0;
      font-size: 14px;
    }

    .size-table th {
      background: var(--nzsk-yellow-light);
      padding: 10px;
      text-align: left;
      border: 1px solid var(--nzsk-yellow);
      font-weight: 600;
    }

    .size-table td {
      padding: 8px 10px;
      border: 1px solid var(--nzsk-gray);
    }

    .size-table tr:hover {
      background: var(--nzsk-yellow-light);
    }

    /* НОВЫЕ СТИЛИ ДЛЯ КНОПОК ПРОФИЛЯ */
    .profile-type-buttons {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      margin-bottom: 20px;
      padding: 10px;
      background: var(--nzsk-gray-light);
      border-radius: var(--radius-sm);
      border: 1px solid var(--nzsk-gray);
    }

    .profile-type-btn {
      padding: 10px 15px;
      background: var(--nzsk-white);
      border: 2px solid var(--nzsk-gray);
      border-radius: var(--radius-sm);
      color: var(--nzsk-gray-dark);
      font-weight: 600;
      cursor: pointer;
      transition: var(--transition);
      display: flex;
      align-items: center;
      gap: 8px;
      white-space: nowrap;
    }

    .profile-type-btn:hover {
      border-color: var(--nzsk-yellow);
      background: var(--nzsk-yellow-light);
    }

    .profile-type-btn.active {
      background: var(--nzsk-yellow);
      border-color: var(--nzsk-yellow);
      color: var(--nzsk-black);
    }

    .profile-type-btn i {
      font-size: 14px;
    }

    /* Стили для сетки размеров */
    .size-options-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
      gap: 10px;
      margin-top: 10px;
      max-height: 200px;
      overflow-y: auto;
      padding: 10px;
      border: 1px solid var(--nzsk-gray);
      border-radius: var(--radius-sm);
      background: var(--nzsk-white);
    }

    .size-option {
      padding: 10px;
      border: 2px solid var(--nzsk-gray);
      border-radius: var(--radius-sm);
      cursor: pointer;
      transition: var(--transition);
      text-align: center;
      font-size: 14px;
    }

    .size-option:hover {
      border-color: var(--nzsk-yellow);
      background: var(--nzsk-yellow-light);
    }

    .size-option.selected {
      background: var(--nzsk-yellow);
      border-color: var(--nzsk-yellow);
      font-weight: 600;
    }

    /* Стили для отображения параметров при выборе */
    .selected-size-info {
      background: var(--nzsk-yellow-light);
      padding: 15px;
      border-radius: var(--radius-sm);
      border: 1px solid var(--nzsk-yellow);
      margin: 15px 0;
      font-size: 14px;
    }

    .selected-size-info div {
      margin-bottom: 5px;
    }

    /* Контакты */
    .contacts-footer {
      background: var(--nzsk-white);
      color: var(--nzsk-black);
      padding: 30px;
      border-radius: var(--radius-lg);
      text-align: center;
      margin-top: 30px;
      border-top: 3px solid var(--nzsk-yellow);
      box-shadow: var(--shadow-lg);
    }

    .contacts-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 20px;
      margin: 25px 0;
    }

    .contact-item {
      padding: 20px;
      background: var(--nzsk-gray-light);
      border-radius: var(--radius-sm);
      transition: var(--transition);
      border: 1px solid var(--nzsk-gray);
    }

    .contact-item:hover {
      background: var(--nzsk-yellow-light);
      transform: translateY(-3px);
      border-color: var(--nzsk-yellow);
    }

    .contact-icon {
      font-size: 24px;
      margin-bottom: 10px;
      color: var(--nzsk-yellow-dark);
    }

    /* Адаптивность */
    @media (max-width: 768px) {
      body {
        padding: 10px;
      }

      .header {
        padding: 20px;
        flex-direction: column;
        gap: 15px;
        text-align: center;
      }

      .tabs {
        flex-direction: column;
      }

      .tab {
        padding: 15px;
        justify-content: flex-start;
      }

      .tab-content {
        padding: 20px;
      }

      .button-group {
        flex-direction: column;
      }

      .info-cards {
        grid-template-columns: 1fr;
      }

      .timer-clock {
        font-size: 32px;
      }
      
      .custom-select-dropdown {
        position: fixed;
        left: 10px;
        right: 10px;
        top: 50%;
        transform: translateY(-50%);
        max-height: 70vh;
      }
      
      .input-group-row {
        grid-template-columns: 1fr;
      }
    }

    /* Утилиты */
    .hidden {
      display: none;
    }

    .visible {
      display: block;
    }

    .text-center {
      text-align: center;
    }

    .mb-10 {
      margin-bottom: 10px;
    }

    .mb-15 {
      margin-bottom: 15px;
    }

    .mb-20 {
      margin-bottom: 20px;
    }

    .mt-10 {
      margin-top: 10px;
    }

    .mt-15 {
      margin-top: 15px;
    }

    .mt-20 {
      margin-top: 20px;
    }

    /* Уведомления */
    .notification {
      position: fixed;
      top: 20px;
      right: 20px;
      padding: 15px 20px;
      border-radius: var(--radius-sm);
      background: var(--nzsk-white);
      box-shadow: var(--shadow-lg);
      z-index: 1000;
      display: flex;
      align-items: center;
      gap: 12px;
      animation: slideInRight 0.3s ease;
      max-width: 400px;
      border-left: 4px solid var(--nzsk-yellow);
      color: var(--nzsk-black);
    }

    .notification.success {
      border-left-color: var(--success);
    }

    .notification.warning {
      border-left-color: var(--warning);
    }

    .notification.error {
      border-left-color: var(--danger);
    }

    @keyframes slideInRight {
      from { opacity: 0; transform: translateX(20px); }
      to { opacity: 1; transform: translateX(0); }
    }
  </style>
</head>
<body>
  <!-- Уведомления -->
  <div id="notification" class="notification hidden"></div>

  <div class="container">
    <!-- Шапка -->
    <div class="header">
      <div class="logo">
        <div class="logo-icon">
          <i class="fas fa-calculator"></i>
        </div>
        <div class="logo-text">
          <h1>Калькулятор расхода огнезащитных материалов НЗСК</h1>
          <p>Расчет расхода Спец-ВМ, Спец-Конструктив и системных решений</p>
        </div>
      </div>
      <div class="status-indicator">
        <span class="status-dot"></span>
        <span>Система активна</span>
      </div>
    </div>

    <!-- Основная карточка -->
    <div class="main-card">
      <!-- Навигация -->
      <div class="tabs">
        <button class="tab active" onclick="switchTab('calculator')">
          <i class="fas fa-calculator"></i>Калькулятор расхода
        </button>
        <button class="tab" onclick="switchTab('check')">
          <i class="fas fa-clipboard-check"></i>Проверка условий
        </button>
        <button class="tab" onclick="switchTab('timer')">
          <i class="fas fa-hourglass-half"></i>Таймер сушки
        </button>
        <button class="tab" onclick="switchTab('history')">
          <i class="fas fa-history"></i>История
        </button>
        <button class="tab" onclick="switchTab('info')">
          <i class="fas fa-info-circle"></i>Информация
        </button>
      </div>

      <!-- Калькулятор расхода (ПЕРВЫЙ) -->
      <div id="calculator" class="tab-content active">
        <div class="section">
          <div class="section-header">
            <div class="section-icon">
              <i class="fas fa-calculator"></i>
            </div>
            <div>
              <div class="section-title">Калькулятор расхода материалов</div>
              <div class="section-subtitle">Точный расчет количества огнезащитного покрытия НЗСК для металлоконструкций</div>
            </div>
          </div>

          <div class="calculator-tabs">
            <button class="calc-tab active" onclick="switchCalcTab('manual')">Ручной ввод</button>
            <button class="calc-tab" onclick="switchCalcTab('profiles')">Выбор профиля</button>
          </div>

          <div class="content-wrapper">
            <!-- Левая колонка - форма калькулятора -->
            <div class="form-column">
              <!-- Ручной ввод -->
              <div id="manual" class="calc-content active">
                <div class="form-group">
                  <label class="form-label">
                    <i class="fas fa-ruler"></i>
                    Приведенная толщина металла (ПТМ), мм
                  </label>
                  <input type="number" id="ptm" class="form-control" value="5.8" min="1.0" max="18.0" step="0.1">
                </div>

                <div class="form-group">
                  <label class="form-label">
                    <i class="fas fa-ruler-vertical"></i>
                    Длина конструкций, м
                  </label>
                  <input type="number" id="length" class="form-control" value="10" min="0.1" step="0.1">
                  <div class="hint-box mt-10">
                    <i class="fas fa-info-circle"></i>
                    <strong>ВНИМАНИЕ:</strong> Площадь всегда равна длине (S = L)
                  </div>
                </div>

                <div class="form-group">
                  <label class="form-label">
                    <i class="fas fa-ruler-combined"></i>
                    Площадь поверхности, м² (ОПЦИОНАЛЬНО)
                  </label>
                  <input type="number" id="area" class="form-control" placeholder="Введите площадь, если отличается от длины">
                  <div class="hint-box mt-10">
                    <i class="fas fa-info-circle"></i>
                    Если оставить пустым, площадь будет равна длине
                    <div id="calculatedAreaInfo" class="mt-10 hidden">
                      <i class="fas fa-calculator"></i>
                      <span>Используемая площадь: <span id="calculatedAreaValue">0</span> м² (S = L)</span>
                    </div>
                  </div>
                </div>
                
                <!-- Кнопка для расчета площади -->
                <div class="form-group mt-20">
                  <button class="btn btn-outline" onclick="updateAreaFromLength()" style="width: 100%;">
                    <i class="fas fa-sync-alt"></i>Рассчитать площадь из длины
                  </button>
                </div>
              </div>

              <!-- Выбор профиля -->
              <div id="profiles" class="calc-content">
                <!-- КНОПКИ ВЫБОРА ТИПА ПРОФИЛЯ -->
                <div class="profile-type-buttons">
                  <button class="profile-type-btn active" data-type="i-beam">
                    <i class="fas fa-h"></i>Двутавр
                  </button>
                  <button class="profile-type-btn" data-type="channel">
                    <i class="fas fa-c"></i>Швеллер
                  </button>
                  <button class="profile-type-btn" data-type="profile">
                    <i class="fas fa-square"></i>Профиль
                  </button>
                  <button class="profile-type-btn" data-type="pipe">
                    <i class="fas fa-circle"></i>Труба
                  </button>
                  <button class="profile-type-btn" data-type="corner">
                    <i class="fas fa-vector-square"></i>Уголок
                  </button>
                </div>

                <!-- ВЫБОР РАЗМЕРА ПРОФИЛЯ -->
                <div class="form-group">
                  <label class="form-label">
                    <i class="fas fa-ruler-combined"></i>
                    Выберите размер профиля
                  </label>
                  <div class="size-options-grid" id="size-options">
                    <!-- Будет заполнено динамически -->
                  </div>
                </div>

                <!-- ИНФОРМАЦИЯ О ВЫБРАННОМ РАЗМЕРЕ -->
                <div id="selected-size-info" class="selected-size-info hidden">
                  <div><strong>Выбранный размер:</strong> <span id="selected-size-name"></span></div>
                  <div><strong>ПТМ:</strong> <span id="selected-size-ptm"></span> мм</div>
                  <div><strong>Периметр:</strong> <span id="selected-size-perimeter"></span> мм</div>
                  <div><strong>Площадь на 1 м длины:</strong> <span id="selected-size-areaPerMeter"></span> м²/м.п.</div>
                </div>

                <!-- РУЧНОЙ ВВОД ТОЛЬКО ДЛИНЫ -->
                <div class="hint-box mt-20">
                  <i class="fas fa-edit"></i>
                  <strong>Ввод длины профиля</strong>
                  <div style="margin-top: 10px; font-size: 13px;">
                    Введите длину профиля. Площадь будет равна длине (S = L).
                  </div>
                </div>

                <div class="form-group">
                  <label class="form-label">
                    <i class="fas fa-ruler-vertical"></i>
                    Длина профиля, м
                  </label>
                  <input type="number" id="profile-length" class="form-control" value="10" min="0.1" step="0.1">
                </div>

                <div class="hint-box">
                  <i class="fas fa-info-circle"></i>
                  <strong>Доступные стандарты:</strong>
                  <div style="margin-top: 5px; font-size: 12px;">
                    Двутавр: СТО АСЧМ 20-93, ГОСТ Р 57837-2017, ГОСТ 26020-83, ГОСТ 8239-89, ГОСТ 19425-74, DIN 1025<br>
                    Швеллер: ГОСТ 8240-97, DIN 1026<br>
                    Уголок: ГОСТ 8509-93, 8510-86, DIN EN 10056-1-1998<br>
                    Профиль: ГОСТ 30245-2003, DIN EN 10210-2-2006, DIN EN 10219-2-2006
                  </div>
                </div>
              </div>

              <!-- Общие параметры для всех типов -->
              <div class="form-group">
                <label class="form-label">
                  <i class="fas fa-fire"></i>
                  Требуемый предел огнестойкости
                </label>
                <div class="custom-select" id="fireResistance-select">
                  <button type="button" class="custom-select-btn" id="fireResistance-btn">
                    <span id="fireResistance-value">R60 (60 минут)</span>
                    <i class="fas fa-chevron-down"></i>
                  </button>
                  <div class="custom-select-dropdown" id="fireResistance-dropdown">
                    <div class="custom-select-option selected" data-value="R15">R15 (15 минут)</div>
                    <div class="custom-select-option" data-value="R30">R30 (30 минут)</div>
                    <div class="custom-select-option" data-value="R45">R45 (45 минут)</div>
                    <div class="custom-select-option" data-value="R60">R60 (60 минут)</div>
                    <div class="custom-select-option" data-value="R90">R90 (90 минут)</div>
                    <div class="custom-select-option" data-value="R120">R120 (120 минут)</div>
                  </div>
                </div>
              </div>

              <div class="hint-box success">
                <i class="fas fa-lightbulb"></i>
                <strong>Системы покрытия:</strong>
                <div style="margin-top: 10px; font-size: 13px;">
                  <div><b>R15-R60:</b> используется только "Спец-ВМ"</div>
                  <div><b>R90-R120 при ПТМ &lt; 5.8 мм:</b> используется "Конструктив-Металл" (Спец-Конструктив + Спец-ВМ)</div>
                  <div><b>R90-R120 при ПТМ ≥ 5.8 мм:</b> используется только "Спец-ВМ"</div>
                </div>
              </div>

              <div class="button-group">
                <button class="btn btn-primary" onclick="calculateMaterial()">
                  <i class="fas fa-calculator"></i>Рассчитать расход
                </button>
                <button class="btn btn-outline" onclick="clearCalculator()">
                  <i class="fas fa-redo"></i>Очистить
                </button>
              </div>
            </div>

            <!-- Правая колонка - результаты расчета -->
            <div class="results-column">
              <div class="results-header">
                <div class="results-title">
                  <i class="fas fa-chart-bar"></i>
                  Результаты расчета
                </div>
                <div id="calcResultStatus" class="status-badge status-info">Ожидание расчета</div>
              </div>

              <div id="calcResults">
                <div class="text-center" style="padding: 40px 20px; color: var(--nzsk-gray-dark);">
                  <i class="fas fa-calculator" style="font-size: 48px; margin-bottom: 15px; opacity: 0.3;"></i>
                  <div style="font-size: 16px; font-weight: 600;">Введите параметры для расчета</div>
                  <div style="font-size: 14px; margin-top: 10px;">Нажмите "Рассчитать расход" для получения результатов</div>
                </div>
              </div>

              <!-- Блок с детализацией расчета -->
              <div id="detailedCalculation" class="hidden mt-20"></div>

              <!-- Блок с упаковкой -->
              <div id="packingInfo" class="hidden mt-20"></div>

              <!-- Блок с технической информацией -->
              <div id="technicalInfo" class="hidden mt-20"></div>
            </div>
          </div>

          <!-- Справочная информация -->
          <div class="hint-box mt-20">
            <i class="fas fa-book"></i>
            <strong>Справочная информация:</strong>
            <div style="margin-top: 10px; font-size: 13px;">
              <div><b>Спец-ВМ:</b> Плотность 1.65 г/см³, расход = толщина × 1.65 кг/м², фасовка - ведра по 25 кг</div>
              <div><b>Спец-Конструктив:</b> Плотность 1.35 г/см³, расход = толщина × 1.35 кг/м², фасовка - ведра по 18 кг</div>
              <div><b>Конструктив-Металл:</b> Комбинированная система: Спец-Конструктив (18 кг/ведро) + Спец-ВМ (25 кг/ведро)</div>
              <div><b>Расчет площади:</b> Площадь всегда равна длине (S = L)</div>
            </div>
          </div>
        </div>
      </div>

      <!-- Проверка условий -->
      <div id="check" class="tab-content">
        <div class="content-wrapper">
          <!-- Левая колонка - форма -->
          <div class="form-column">
            <!-- Категория поверхности -->
            <div class="section">
              <div class="section-header">
                <div class="section-icon">
                  <i class="fas fa-layer-group"></i>
                </div>
                <div>
                  <div class="section-title">Категория поверхности</div>
                  <div class="section-subtitle">Выберите тип защищаемой конструкции</div>
                </div>
              </div>

              <div class="form-group">
                <label class="form-label">
                  <i class="fas fa-th"></i>
                  Тип конструкции
                </label>
                <div class="custom-select" id="category-select">
                  <button type="button" class="custom-select-btn" id="category-btn">
                    <span id="category-value">Металлические конструкции</span>
                    <i class="fas fa-chevron-down"></i>
                  </button>
                  <div class="custom-select-dropdown" id="category-dropdown">
                    <div class="custom-select-option selected" data-value="metal">Металлические конструкции</div>
                    <div class="custom-select-option" data-value="concrete">Железобетонные конструкции</div>
                    <div class="custom-select-option" data-value="vent">Воздуховоды</div>
                    <div class="custom-select-option" data-value="cable">Кабель и кабельные линии</div>
                    <div class="custom-select-option" data-value="wood">Дерево (Дерево, ДСП, ДВП, фанера)</div>
                  </div>
                </div>
              </div>

              <div class="hint-box">
                <i class="fas fa-lightbulb"></i> 
                Для каждого типа конструкции применяются специальные составы НЗСК
              </div>
            </div>

            <!-- Продукт -->
            <div class="section">
              <div class="section-header">
                <div class="section-icon">
                  <i class="fas fa-paint-roller"></i>
                </div>
                <div>
                  <div class="section-title">Выбор огнезащитного состава</div>
                  <div class="section-subtitle">Подберите продукт НЗСК для выбранной категории</div>
                </div>
              </div>

              <div class="form-group">
                <label class="form-label">
                  <i class="fas fa-layer-group"></i>
                  Продукт или система
                </label>
                <div class="custom-select" id="product-select">
                  <button type="button" class="custom-select-btn" id="product-btn">
                    <span id="product-value">Спец-ВМ (металл, R15–R120)</span>
                    <i class="fas fa-chevron-down"></i>
                  </button>
                  <div class="custom-select-dropdown" id="product-dropdown">
                    <!-- Будет заполняться динамически в зависимости от категории -->
                  </div>
                </div>
              </div>

              <div class="hint-box" id="product-hint">
                <i class="fas fa-lightbulb"></i> 
                Для металлоконструкций — Спец-ВМ, для бетона — Конструктив-Бетон, для кабелей — Спец-ВК
              </div>
            </div>

            <!-- Условия на объекте -->
            <div class="section">
              <div class="section-header">
                <div class="section-icon">
                  <i class="fas fa-temperature-low"></i>
                </div>
                <div>
                  <div class="section-title">Условия на объекте</div>
                  <div class="section-subtitle">Температура и влажность воздуха</div>
                </div>
              </div>

              <div class="form-group">
                <label class="form-label">
                  <i class="fas fa-thermometer-half"></i>
                  Температура, °C
                </label>
                <input type="number" id="temp" class="form-control" value="20" min="-10" max="50" step="1">
                <div id="temp-error" class="error-message"></div>
              </div>

              <div class="form-group">
                <label class="form-label">
                  <i class="fas fa-tint"></i>
                  Влажность, %
                                  </label>
                <input type="number" id="humidity" class="form-control" value="60" min="0" max="100" step="1">
                <div id="humidity-error" class="error-message"></div>
              </div>

              <div class="hint-box">
                <i class="fas fa-info-circle"></i> 
                Оптимальные условия: температура +5...+30°C, влажность до 80%
              </div>
            </div>

            <!-- Поверхность -->
            <div class="section">
              <div class="section-header">
                <div class="section-icon">
                  <i class="fas fa-th"></i>
                </div>
                <div>
                  <div class="section-title">Характеристики поверхности</div>
                  <div class="section-subtitle">Подготовка основания для нанесения</div>
                </div>
              </div>

              <div class="form-group">
                <label class="form-label">
                  <i class="fas fa-drafting-compass"></i>
                  Тип поверхности
                </label>
                <div class="custom-select" id="surface-select">
                  <button type="button" class="custom-select-btn" id="surface-btn">
                    <span id="surface-value">Чистый металл (без ржавчины и ЛКМ)</span>
                    <i class="fas fa-chevron-down"></i>
                  </button>
                  <div class="custom-select-dropdown" id="surface-dropdown">
                    <div class="custom-select-option selected" data-value="clean_metal">Чистый металл (без ржавчины и ЛКМ)</div>
                    <div class="custom-select-option" data-value="galvanized">Оцинковка (чистая)</div>
                    <div class="custom-select-option" data-value="concrete">Бетон/ж/б (чистый)</div>
                    <div class="custom-select-option" data-value="wood">Древесина (чистая, без покрытий)</div>
                    <div class="custom-select-option" data-value="gf021">Грунтовка ГФ-021 (по стали)</div>
                    <div class="custom-select-option" data-value="dv106">Грунтовка ДВ-106 (по оцинковке)</div>
                    <div class="custom-select-option" data-value="other_lkm">Другой ЛКМ, краска, пыль или грязь</div>
                  </div>
                </div>
              </div>

              <div class="form-group">
                <label class="form-label">
                  <i class="fas fa-ruler-combined"></i>
                  Площадь обработки, м² (опционально)
                </label>
                <input type="number" id="area2" class="form-control" placeholder="Например: 150" min="0" step="0.1">
                <div id="area-error" class="error-message"></div>
              </div>

              <div class="hint-box warning">
                <i class="fas fa-exclamation-triangle"></i> 
                Огнезащита НЗСК не наносится по ЛКМ, краске или пыли
              </div>
            </div>

            <!-- Кнопки действий -->
            <div class="button-group">
              <button class="btn btn-primary" onclick="runAssistant()">
                <i class="fas fa-check-circle"></i>Проверить совместимость
              </button>
              <button class="btn btn-secondary" onclick="generateReport()">
                <i class="fas fa-file-pdf"></i>Экспорт отчета
              </button>
              <button class="btn btn-outline" onclick="clearForm()">
                <i class="fas fa-redo"></i>Очистить форму
              </button>
            </div>
            
            <!-- Добавлена подсказка о повторном расчете -->
            <div class="hint-box success">
              <i class="fas fa-info-circle"></i> 
              <strong>Можно менять параметры и повторно нажимать "Проверить совместимость" без очистки формы</strong>
            </div>
          </div>

          <!-- Правая колонка - результаты -->
          <div class="results-column">
            <div class="results-header">
              <div class="results-title">
                <i class="fas fa-chart-line"></i>
                Результаты проверки
              </div>
              <div id="resultStatus" class="status-badge status-info">Ожидание данных</div>
            </div>

            <div id="resultMessages">
              <!-- Результаты будут здесь -->
              <div class="text-center" style="padding: 40px 20px; color: var(--nzsk-gray-dark);">
                <i class="fas fa-clipboard-list" style="font-size: 48px; margin-bottom: 15px; opacity: 0.3;"></i>
                <div style="font-size: 16px; font-weight: 600;">Введите данные для проверки</div>
                <div style="font-size: 14px; margin-top: 10px;">Нажмите "Проверить совместимость" для расчета</div>
              </div>
            </div>

            <div id="compatibilitySection" class="hidden">
              <div class="progress-container">
                <div class="progress-label">
                  <span>Совместимость с поверхностью</span>
                  <span id="compatibilityPercent">0%</span>
                </div>
                <div class="progress-bar">
                  <div id="compatibilityBar" class="progress-fill" style="width: 0%"></div>
                </div>
              </div>
            </div>

            <!-- Блок для яркой подсветки несовместимости -->
            <div id="incompatibleWarning" class="hidden incompatible-highlight"></div>

            <div id="fireResistanceSection" class="hidden"></div>

            <div id="seasonAdvice" class="hidden"></div>

            <div id="supportSection" class="hidden"></div>

            <!-- Блок для расчета материала -->
            <div id="materialCalculation" class="hidden"></div>
          </div>
        </div>
      </div>

      <!-- Таймер сушки -->
      <div id="timer" class="tab-content">
        <div class="section">
          <div class="section-header">
            <div class="section-icon">
              <i class="fas fa-hourglass-half"></i>
            </div>
            <div>
              <div class="section-title">Таймер межслойной сушки</div>
              <div class="section-subtitle">Контроль времени между нанесением слоев</div>
            </div>
          </div>

          <!-- Добавляем выбор краски для таймера -->
          <div class="form-group mb-20">
            <label class="form-label">
              <i class="fas fa-paint-roller"></i>
              Выберите продукт для таймера
            </label>
            <div class="custom-select" id="timerProduct-select">
              <button type="button" class="custom-select-btn" id="timerProduct-btn">
                <span id="timerProduct-value">Спец-ВМ (металл, R15–R120)</span>
                <i class="fas fa-chevron-down"></i>
              </button>
              <div class="custom-select-dropdown" id="timerProduct-dropdown">
                <div class="custom-select-option selected" data-value="vm">Спец-ВМ (металл, R15–R120)</div>
                <div class="custom-select-option" data-value="konstruktiv">Спец-Конструктив (абляционный слой)</div>
                <div class="custom-select-option" data-value="konstruktiv_metal">Конструктив-Металл (система для стали)</div>
                <div class="custom-select-option" data-value="konstruktiv_beton">Конструктив-Бетон (система для ж/б)</div>
                <div class="custom-select-option" data-value="vk">Спец-ВК (кабель и кабельные линии)</div>
                <div class="custom-select-option" data-value="vv">Спец-ВВ (воздуховоды)</div>
                <div class="custom-select-option" data-value="vd">Спец-ВД (деревянные конструкции)</div>
              </div>
            </div>
          </div>

          <div class="form-group mb-20">
            <label class="form-label">
              <i class="fas fa-thermometer-half"></i>
              Температура для расчета, °C
            </label>
            <input type="number" id="timerTemp" class="form-control" value="20" min="-10" max="50" step="1">
          </div>

          <div class="timer-container">
            <div class="timer-display">
              <div class="timer-title">Время до нанесения следующего слоя</div>
              <div id="timerClock" class="timer-clock">--:--:--</div>
              <div id="timerInfo" class="mb-15">Выберите продукт и температуру</div>
              
              <div class="progress-container">
                <div class="progress-label">
                  <span>Прогресс сушки</span>
                  <span id="timerPercent">0%</span>
                </div>
                <div class="progress-bar">
                  <div id="timerProgress" class="progress-fill" style="width: 0%"></div>
                </div>
              </div>

              <div class="button-group mt-20">
                <button class="btn btn-primary" onclick="startDryingTimer()" id="startTimerBtn">
                  <i class="fas fa-play"></i>Запустить таймер
                </button>
                <button class="btn btn-outline" onclick="resetTimer()" id="resetTimerBtn">
                  <i class="fas fa-stop"></i>Сбросить
                </button>
              </div>
            </div>
          </div>

          <div class="hint-box">
            <i class="fas fa-clock"></i> 
            Время сушки зависит от температуры и влажности. При низких температурах время увеличивается.
          </div>
        </div>
      </div>

      <!-- История -->
      <div id="history" class="tab-content">
        <div class="section">
          <div class="section-header">
            <div class="section-icon">
              <i class="fas fa-history"></i>
            </div>
            <div>
              <div class="section-title">История проверок</div>
              <div class="section-subtitle">Архив выполненных расчетов</div>
            </div>
          </div>

          <div id="historyPanel" class="results-column">
            <div id="historyItems">
              <!-- История будет загружена здесь -->
            </div>
          </div>

          <div class="button-group">
            <button class="btn btn-outline" onclick="clearHistory()">
              <i class="fas fa-trash-alt"></i>Очистить историю
            </button>
            <button class="btn btn-secondary" onclick="exportHistory()">
              <i class="fas fa-file-export"></i>Экспорт истории
            </button>
          </div>
        </div>
      </div>

      <!-- Информация -->
      <div id="info" class="tab-content">
        <div class="section">
          <div class="section-header">
            <div class="section-icon">
              <i class="fas fa-info-circle"></i>
            </div>
            <div>
              <div class="section-title">Техническая информация</div>
              <div class="section-subtitle">Справочные данные по продукции НЗСК</div>
            </div>
          </div>

          <div class="info-cards">
            <div class="info-card">
              <div class="info-card-title">
                <i class="fas fa-temperature-low"></i>Температурный режим
              </div>
              <div class="info-card-value">+5...+40°C</div>
              <div class="info-card-unit">Температура нанесения</div>
            </div>

            <div class="info-card">
              <div class="info-card-title">
                <i class="fas fa-tint"></i>Влажность воздуха
              </div>
              <div class="info-card-value">≤80%</div>
              <div class="info-card-unit">Максимальная влажность</div>
            </div>

            <div class="info-card">
              <div class="info-card-title">
                <i class="fas fa-clock"></i>Время сушки
              </div>
              <div class="info-card-value">24 ч</div>
              <div class="info-card-unit">Межслойная сушка (20°C)</div>
            </div>

            <div class="info-card">
              <div class="info-card-title">
                <i class="fas fa-fire"></i>Огнестойкость
              </div>
              <div class="info-card-value">R15-R120</div>
              <div class="info-card-unit">Предел огнестойкости</div>
            </div>
          </div>

          <div class="hint-box">
            <i class="fas fa-exclamation-circle"></i> 
            <strong>Важно:</strong> Данный инструмент является вспомогательным. Для точных расчетов обратитесь к техническим специалистам НЗСК.
          </div>
        </div>
      </div>
    </div>

    <!-- Контакты -->
    <div class="contacts-footer">
      <h3 style="margin-bottom: 25px; font-size: 22px; color: var(--nzsk-black);">Техническая поддержка НЗСК</h3>
      
      <div class="contacts-grid">
        <div class="contact-item">
          <div class="contact-icon">
            <i class="fas fa-phone"></i>
          </div>
          <div style="font-weight: 700; margin-bottom: 5px; color: var(--nzsk-black);">Телефон</div>
          <div>+7 (383) 375-90-07</div>
        </div>

        <div class="contact-item">
          <div class="contact-icon">
            <i class="fas fa-envelope"></i>
          </div>
          <div style="font-weight: 700; margin-bottom: 5px; color: var(--nzsk-black);">Email</div>
          <div>nz-ck@mail.ru</div>
        </div>

        <div class="contact-item">
          <div class="contact-icon">
            <i class="fas fa-globe"></i>
          </div>
          <div style="font-weight: 700; margin-bottom: 5px; color: var(--nzsk-black);">Сайт</div>
          <div>https://nzck.ru/</div>
        </div>

        <div class="contact-item">
          <div class="contact-icon">
            <i class="fas fa-map-marker-alt"></i>
          </div>
          <div style="font-weight: 700; margin-bottom: 5px; color: var(--nzsk-black);">Адрес</div>
          <div>г. Новосибирск, Завод НЗСК</div>
        </div>
      </div>

      <div style="margin-top: 30px; font-size: 14px; color: var(--nzsk-gray-dark);">
        © 2025 Завод НЗСК. Все права защищены. Калькулятор расхода огнезащитных материалов.
      </div>
    </div>
  </div>

  <script>
    // БАЗА ДАННЫХ ПРОДУКТОВ НЗСК с обновленной упаковкой
    const PRODUCTS = {
      vm: {
        id: 'vm',
        name: 'Спец-ВМ',
        fullName: 'Спец-ВМ (металл, R15–R120)',
        type: 'Огнезащитная краска для металла',
        category: 'metal',
        minTemp: 5,
        maxTemp: 40,
        maxHumidity: 80,
        density: 1.65,
        dryResidue: 64,
        grind: 40,
        dryingTime: function(temp) {
          if (temp >= 20) return 24;
          if (temp >= 15) return 30;
          if (temp >= 10) return 36;
          if (temp >= 5) return 48;
          return 72;
        },
        serviceLife: 25,
        warranty: 12,
        storageTemp: '-40...+40°C (готовое), -60...+60°C (сухая смесь)',
        compatibility: {
          clean_metal: true,
          galvanized: true,
          concrete: false,
          wood: false,
          gf021: true,
          dv106: true,
          other_lkm: false
        },
        consumption: {
          R15: { thickness: 0.4, consumption: 0.66 },
          R30: { thickness: 0.6, consumption: 0.99 },
          R45: { thickness: 0.8, consumption: 1.32 },
          R60: { thickness: 1.0, consumption: 1.65 },
          R90: { thickness: 1.4, consumption: 2.31 },
          R120: { thickness: 1.8, consumption: 2.97 }
        },
        packaging: {
          bucket_25: { weight: 25, coverage_R60: 15.2 },
          bucket_12: { weight: 12, coverage_R60: 7.3 },
          bucket_5: { weight: 5, coverage_R60: 3.0 }
        }
      },
      
      konstruktiv: {
        id: 'konstruktiv',
        name: 'Спец-Конструктив',
        fullName: 'Спец-Конструктив (абляционный слой)',
        type: 'Абляционный состав',
        category: 'metal',
        minTemp: 5,
        maxTemp: 40,
        maxHumidity: 80,
        density: 1.35,
        dryResidue: 60,
        dryingTime: 24,
        serviceLife: 25,
        warranty: 12,
        storageTemp: '-40...+40°C',
        compatibility: {
          clean_metal: true,
          galvanized: true,
          concrete: true,
          wood: false,
          gf021: true,
          dv106: true,
          other_lkm: false
        },
        consumption: {
          standard: { thickness: 2.0, consumption: 2.7 }
        },
        packaging: {
          bucket_18: { weight: 18, coverage_standard: 6.7 },
          bucket_9: { weight: 9, coverage_standard: 3.3 }
        }
      },
      
      konstruktiv_metal: {
        id: 'konstruktiv_metal',
        name: 'Конструктив-Металл',
        fullName: 'Конструктив-Металл (система для стали)',
        type: 'Комбинированная система для металла',
        category: 'metal',
        minTemp: 5,
        maxTemp: 40,
        maxHumidity: 80,
        density: '1.65/1.35',
        dryResidue: '64/60',
        serviceLife: 25,
        warranty: 12,
        storageTemp: '-35...+40°C',
        isSystem: true,
        components: ['vm', 'konstruktiv'],
        compatibility: {
          clean_metal: true,
          galvanized: true,
          concrete: false,
          wood: false,
          gf021: true,
          dv106: true,
          other_lkm: false
        },
        consumption: {
          R30: {
            totalThickness: 2.0,
            totalConsumption: 3.3,
            components: {
              vm: { thickness: 0.6, consumption: 0.99 },
              konstruktiv: { thickness: 1.4, consumption: 1.89 }
            }
          },
          R60: {
            totalThickness: 3.0,
            totalConsumption: 4.65,
            components: {
              vm: { thickness: 1.0, consumption: 1.65 },
              konstruktiv: { thickness: 2.0, consumption: 2.7 }
            }
          },
          R90: {
            totalThickness: 4.0,
            totalConsumption: 6.3,
            components: {
              vm: { thickness: 1.4, consumption: 2.31 },
              konstruktiv: { thickness: 2.6, consumption: 3.51 }
            }
          },
          R120: {
            totalThickness: 5.0,
            totalConsumption: 8.0,
            components: {
              vm: { thickness: 1.8, consumption: 2.97 },
              konstruktiv: { thickness: 3.2, consumption: 4.32 }
            }
          }
        },
        packaging: {
          set_R60: {
            description: 'Комплект на 30 м² (R60)',
            vm_kg: 49.5,
            konstruktiv_kg: 81,
            total_kg: 130.5,
            coverage: 30
          }
        }
      },
      
      konstruktiv_beton: {
        id: 'konstruktiv_beton',
        name: 'Конструктив-Бетон',
        fullName: 'Конструктив-Бетон (система для железобетона)',
        type: 'Комбинированная система для железобетона',
        category: 'concrete',
        minTemp: 5,
        maxTemp: 40,
        maxHumidity: 80,
        density: '1.65/1.35',
        dryResidue: '64/60',
        serviceLife: 25,
        warranty: 12,
        storageTemp: '-35...+40°C',
        isSystem: true,
        components: ['vm', 'konstruktiv'],
        compatibility: {
          clean_metal: false,
          galvanized: false,
          concrete: true,
          wood: false,
          gf021: false,
          dv106: false,
          other_lkm: false
        },
        consumption: {
          R30: {
            totalThickness: 2.0,
            totalConsumption: 3.3,
            components: {
              vm: { thickness: 0.6, consumption: 0.99 },
              konstruktiv: { thickness: 1.4, consumption: 1.89 }
            }
          },
          R60: {
            totalThickness: 3.0,
            totalConsumption: 4.65,
            components: {
              vm: { thickness: 1.0, consumption: 1.65 },
              konstruktiv: { thickness: 2.0, consumption: 2.7 }
            }
          },
          R90: {
            totalThickness: 4.0,
            totalConsumption: 6.3,
            components: {
              vm: { thickness: 1.4, consumption: 2.31 },
              konstruktiv: { thickness: 2.6, consumption: 3.51 }
            }
          },
          R120: {
            totalThickness: 5.0,
            totalConsumption: 8.0,
            components: {
              vm: { thickness: 1.8, consumption: 2.97 },
              konstruktiv: { thickness: 3.2, consumption: 4.32 }
            }
          }
        },
        packaging: {
          set_R60: {
            description: 'Комплект на 30 м² (R60)',
            vm_kg: 49.5,
            konstruktiv_kg: 81,
            total_kg: 130.5,
            coverage: 30
          }
        }
      },
      
      vk: {
        id: 'vk',
        name: 'Спец-ВК',
        fullName: 'Спец-ВК (кабель и кабельные линии)',
        type: 'Огнезащитная краска для кабелей',
        category: 'cable',
        minTemp: 5,
        maxTemp: 40,
        maxHumidity: 85,
        density: 1.225,
        dryResidue: 67.5,
        dryingTime: 24,
        serviceLife: 30,
        warranty: 12,
        storageTemp: '+5...+40°C',
        compatibility: {
          clean_metal: false,
          galvanized: false,
          concrete: false,
          wood: false,
          gf021: false,
          dv106: false,
          other_lkm: false
        },
        consumption: {
          standard: { thickness: 0.7, consumption: 0.8575 }
        },
        packaging: {
          bucket_25: { weight: 25, coverage_standard: 29.2 },
          bucket_12: { weight: 12, coverage_standard: 14.0 }
        }
      },
      
      vv: {
        id: 'vv',
        name: 'Спец-ВВ',
        fullName: 'Спец-ВВ (воздуховоды)',
        type: 'Огнезащитная краска для воздуховодов',
        category: 'vent',
        minTemp: 5,
        maxTemp: 40,
        maxHumidity: 80,
        density: 1.325,
        dryResidue: 67.5,
        dryingTime: 24,
        serviceLife: 20,
        warranty: 12,
        storageTemp: '+5...+40°C',
        compatibility: {
          clean_metal: true,
          galvanized: true,
          concrete: false,
          wood: false,
          gf021: true,
          dv106: true,
          other_lkm: false
        },
        consumption: {
          standard: { thickness: 1.3, consumption: 1.7225 }
        },
        packaging: {
          bucket_25: { weight: 25, coverage_standard: 14.5 },
          bucket_12: { weight: 12, coverage_standard: 7.0 }
        }
      },
      
      vd: {
        id: 'vd',
        name: 'Спец-ВД',
        fullName: 'Спец-ВД (деревянные конструкции)',
        type: 'Огнезащитная краска для дерева',
        category: 'wood',
        minTemp: 5,
        maxTemp: 40,
        maxHumidity: 85,
        density: 1.3,
        dryResidue: 71,
        dryingTime: 24,
        serviceLife: 20,
        warranty: 12,
        storageTemp: '+5...+40°C',
        compatibility: {
          clean_metal: false,
          galvanized: false,
          concrete: false,
          wood: true,
          gf021: false,
          dv106: false,
          other_lkm: false
        },
        consumption: {
          standard: { thickness: 0.23, consumption: 0.299 }
        },
        packaging: {
          bucket_25: { weight: 25, coverage_standard: 83.6 },
          bucket_12: { weight: 12, coverage_standard: 40.1 }
        }
      }
    };

    // КЛАССИФИКАЦИЯ ПРОДУКТОВ ПО КАТЕГОРИЯМ
    const PRODUCTS_BY_CATEGORY = {
      metal: [
        { id: 'vm', name: 'Спец-ВМ (металл, R15–R120)' },
        { id: 'konstruktiv', name: 'Спец-Конструктив (абляционный слой)' },
        { id: 'konstruktiv_metal', name: 'Конструктив-Металл (система для стали)' }
      ],
      concrete: [
        { id: 'konstruktiv_beton', name: 'Конструктив-Бетон (система для железобетона)' },
        { id: 'konstruktiv', name: 'Спец-Конструктив (абляционный слой)' }
      ],
      vent: [
        { id: 'vv', name: 'Спец-ВВ (воздуховоды)' },
        { id: 'vm', name: 'Спец-ВМ (металл, R15–R120)' }
      ],
      cable: [
        { id: 'vk', name: 'Спец-ВК (кабель и кабельные линии)' }
      ],
      wood: [
        { id: 'vd', name: 'Спец-ВД (деревянные конструкции)' }
      ]
    };

    // ПОДСКАЗКИ ДЛЯ КАТЕГОРИЙ
    const CATEGORY_HINTS = {
      metal: 'Для металлоконструкций — Спец-ВМ, для усиленной защиты — Конструктив-Металл',
      concrete: 'Для железобетонных конструкций — Конструктив-Бетон или Спец-Конструктив',
      vent: 'Для воздуховодов и вентиляционных систем — Спец-ВВ',
      cable: 'Для кабелей и кабельных линий — Спец-ВК',
      wood: 'Для деревянных конструкций — Спец-ВД'
    };

    // РАСШИРЕННАЯ БАЗА ДАННЫХ ПРОФИЛЕЙ с обновленными размерами
    const PROFILES_DATA = {
      'i-beam': {
        name: 'Двутавр',
        sizes: [
          // ГОСТ Р 57837-2017 - Тип Б
          { name: '10Б1', ptm: 2.582, perimeter: 399.782, areaPerMeter: 0.4 },
          { name: '12Б1', ptm: 2.339, perimeter: 471.582, areaPerMeter: 0.472 },
          { name: '12Б2', ptm: 2.78, perimeter: 475.182, areaPerMeter: 0.475 },
          { name: '14Б1', ptm: 2.447, perimeter: 547.182, areaPerMeter: 0.547 },
          { name: '14Б2', ptm: 2.983, perimeter: 550.582, areaPerMeter: 0.551 },
          { name: '16Б1', ptm: 2.616, perimeter: 618.549, areaPerMeter: 0.619 },
          { name: '16Б2', ptm: 3.227, perimeter: 622.549, areaPerMeter: 0.623 },
          { name: '18Б1', ptm: 2.821, perimeter: 693.949, areaPerMeter: 0.694 },
          { name: '18Б2', ptm: 3.431, perimeter: 697.949, areaPerMeter: 0.698 },
          { name: '20Б0', ptm: 3.033, perimeter: 764.115, areaPerMeter: 0.764 },
          { name: '20Б1', ptm: 3.527, perimeter: 770.115, areaPerMeter: 0.77 },
          { name: '20Б2', ptm: 4.137, perimeter: 778.115, areaPerMeter: 0.778 },
          { name: '20Б3', ptm: 5.099, perimeter: 789.115, areaPerMeter: 0.789 },
          { name: '25Б1', ptm: 3.399, perimeter: 961.398, areaPerMeter: 0.961 },
          { name: '25Б2', ptm: 3.893, perimeter: 967.398, areaPerMeter: 0.967 },
          { name: '25Б3', ptm: 4.867, perimeter: 978.398, areaPerMeter: 0.978 },
          { name: '25Б4', ptm: 5.829, perimeter: 989.398, areaPerMeter: 0.989 },
          { name: '30Б1', ptm: 3.521, perimeter: 1158.681, areaPerMeter: 1.159 },
          { name: '30Б2', ptm: 4.017, perimeter: 1164.681, areaPerMeter: 1.165 },
          { name: '30Б3', ptm: 4.996, perimeter: 1175.681, areaPerMeter: 1.176 },
          { name: '30Б4', ptm: 5.966, perimeter: 1186.681, areaPerMeter: 1.187 },
          { name: '35Б1', ptm: 3.897, perimeter: 1351.965, areaPerMeter: 1.352 },
          { name: '35Б2', ptm: 4.636, perimeter: 1361.965, areaPerMeter: 1.362 },
          { name: '35Б3', ptm: 5.614, perimeter: 1372.965, areaPerMeter: 1.373 },
          { name: '35Б4', ptm: 6.702, perimeter: 1385.965, areaPerMeter: 1.386 },
          { name: '40Б1', ptm: 4.666, perimeter: 1546.531, areaPerMeter: 1.547 },
          { name: '40Б2', ptm: 5.404, perimeter: 1556.531, areaPerMeter: 1.557 },
          { name: '40Б3', ptm: 6.502, perimeter: 1569.531, areaPerMeter: 1.57 },
          { name: '40Б4', ptm: 7.589, perimeter: 1582.531, areaPerMeter: 1.583 },
          { name: '45Б1', ptm: 5.137, perimeter: 1641.097, areaPerMeter: 1.641 },
          { name: '45Б2', ptm: 5.86, perimeter: 1651.097, areaPerMeter: 1.651 },
          { name: '45БЗ', ptm: 6.937, perimeter: 1664.097, areaPerMeter: 1.664 },
          { name: '45Б4', ptm: 8.003, perimeter: 1677.097, areaPerMeter: 1.677 },
          
          // ГОСТ Р 57837-2017 - Тип Ш
          { name: '20Ш0', ptm: 3.297, perimeter: 943.681, areaPerMeter: 0.944 },
          { name: '20Ш1', ptm: 4.091, perimeter: 953.681, areaPerMeter: 0.954 },
          { name: '20Ш2', ptm: 5.119, perimeter: 964.681, areaPerMeter: 0.965 },
          { name: '20Ш3', ptm: 6.134, perimeter: 975.681, areaPerMeter: 0.976 },
          { name: '20Ш4', ptm: 7.524, perimeter: 997.681, areaPerMeter: 0.998 },
          { name: '20Ш5', ptm: 8.888, perimeter: 1015.681, areaPerMeter: 1.016 },
          { name: '20Ш6', ptm: 10.821, perimeter: 1037.681, areaPerMeter: 1.038 },
          { name: '25Ш0', ptm: 4.121, perimeter: 1136.531, areaPerMeter: 1.137 },
          { name: '25Ш1', ptm: 4.905, perimeter: 1146.531, areaPerMeter: 1.147 },
          { name: '25Ш2', ptm: 5.925, perimeter: 1157.531, areaPerMeter: 1.158 },
          { name: '25Ш3', ptm: 7.314, perimeter: 1171.531, areaPerMeter: 1.172 },
          { name: '25Ш4', ptm: 8.939, perimeter: 1202.531, areaPerMeter: 1.203 },
          { name: '30Ш0', ptm: 4.619, perimeter: 1331.097, areaPerMeter: 1.331 },
          { name: '35Ш1', ptm: 5.154, perimeter: 1613.664, areaPerMeter: 1.614 },
          { name: '40Ш1', ptm: 5.927, perimeter: 1905.23, areaPerMeter: 1.905 },
          { name: '45Ш0', ptm: 6.743, perimeter: 2002.796, areaPerMeter: 2.003 },
          { name: '50Ш1', ptm: 6.938, perimeter: 2097.363, areaPerMeter: 2.097 },
          { name: '60Ш1', ptm: 7.613, perimeter: 2291.929, areaPerMeter: 2.292 },
          { name: '70Ш1', ptm: 8.426, perimeter: 2509.929, areaPerMeter: 2.51 },
          
          // ГОСТ Р 57837-2017 - Тип К
          { name: '15К1', ptm: 3.977, perimeter: 859.115, areaPerMeter: 0.859 },
          { name: '20К1', ptm: 4.571, perimeter: 1152.681, areaPerMeter: 1.153 },
          { name: '25К1', ptm: 5.519, perimeter: 1444.531, areaPerMeter: 1.445 },
          { name: '30К1', ptm: 6.357, perimeter: 1743.097, areaPerMeter: 1.743 },
          { name: '35К1', ptm: 6.877, perimeter: 2021.664, areaPerMeter: 2.022 },
          { name: '40К1', ptm: 8.052, perimeter: 2320.23, areaPerMeter: 2.32 },
          
          // ГОСТ Р 57837-2017 - Тип С
          { name: '13С1', ptm: 4.702, perimeter: 670.398, areaPerMeter: 0.67 },
          { name: '20С1', ptm: 6.115, perimeter: 1169.681, areaPerMeter: 1.17 },
          { name: '25С1', ptm: 5.673, perimeter: 1446.531, areaPerMeter: 1.447 },
          { name: '30С1', ptm: 6.184, perimeter: 1741.097, areaPerMeter: 1.741 },
          { name: '35С1', ptm: 6.697, perimeter: 2019.664, areaPerMeter: 2.02 },
          { name: '40С1', ptm: 11.439, perimeter: 1560.115, areaPerMeter: 1.56 }
        ]
      },
      
      'channel': {
        name: 'Швеллер',
        sizes: [
          // ГОСТ 8240-97
          { name: '5У', ptm: 2.949, perimeter: 209.283, areaPerMeter: 0.209 },
          { name: '10У', ptm: 3.025, perimeter: 362.113, areaPerMeter: 0.362 },
          { name: '20У', ptm: 3.473, perimeter: 674.207, areaPerMeter: 0.674 },
          { name: '30У', ptm: 4.21, perimeter: 961.992, areaPerMeter: 0.962 },
          { name: '40У', ptm: 5.071, perimeter: 1214.256, areaPerMeter: 1.214 },
          
          // DIN 1026 UPN
          { name: 'UPN-30x15', ptm: 2.093, perimeter: 105.69, areaPerMeter: 0.106 },
          { name: 'UPN-40x20', ptm: 2.569, perimeter: 142.364, areaPerMeter: 0.142 },
          { name: 'UPN-50', ptm: 3.102, perimeter: 229.467, areaPerMeter: 0.229 },
          { name: 'UPN-100', ptm: 3.617, perimeter: 372, areaPerMeter: 0.372 },
          { name: 'UPN-200', ptm: 4.874, perimeter: 660.345, areaPerMeter: 0.66 },
          { name: 'UPN-300', ptm: 6.191, perimeter: 949.115, areaPerMeter: 0.949 },
          { name: 'UPN-400', ptm: 7.683, perimeter: 1182.03, areaPerMeter: 1.182 },
          
          // DIN 1026-2-2002 UPE
          { name: 'UPE-80', ptm: 2.932, perimeter: 343.416, areaPerMeter: 0.343 },
          { name: 'UPE-140', ptm: 3.544, perimeter: 519.699, areaPerMeter: 0.52 },
          { name: 'UPE-200', ptm: 4.162, perimeter: 696.841, areaPerMeter: 0.697 },
          { name: 'UPE-300', ptm: 5.848, perimeter: 968.124, areaPerMeter: 0.968 },
          { name: 'UPE-400', ptm: 7.55, perimeter: 1217.549, areaPerMeter: 1.218 }
        ]
      },
      
      'profile': {
        name: 'Профиль',
        sizes: [
          // ГОСТ 30245-2003 квадратные и прямоугольные
          { name: '40 x 40 x 2', ptm: 1.918, perimeter: 153.133, areaPerMeter: 0.153 },
          { name: '50 x 50 x 4', ptm: 3.73, perimeter: 186.265, areaPerMeter: 0.186 },
          { name: '100 x 50 x 5', ptm: 4.722, perimeter: 282.832, areaPerMeter: 0.283 },
          { name: '150 x 150 x 5', ptm: 4.865, perimeter: 582.832, areaPerMeter: 0.583 },
          { name: '200 x 200 x 10', ptm: 9.585, perimeter: 757.08, areaPerMeter: 0.757 },
          { name: '300 x 200 x 10', ptm: 9.672, perimeter: 957.08, areaPerMeter: 0.957 },
          { name: '400 x 200 x 10', ptm: 9.728, perimeter: 1157.08, areaPerMeter: 1.157 }
        ]
      },
      
      'pipe': {
        name: 'Труба',
        sizes: [
          // Трубы по размерам (примерные значения)
          { name: 'Ø25×2', ptm: 2.0, perimeter: 79, areaPerMeter: 0.079 },
          { name: 'Ø32×2.5', ptm: 2.5, perimeter: 101, areaPerMeter: 0.101 },
          { name: 'Ø48×3', ptm: 3.0, perimeter: 151, areaPerMeter: 0.151 },
          { name: 'Ø57×3', ptm: 3.0, perimeter: 179, areaPerMeter: 0.179 },
          { name: 'Ø76×3', ptm: 3.0, perimeter: 239, areaPerMeter: 0.239 },
          { name: 'Ø89×4', ptm: 4.0, perimeter: 280, areaPerMeter: 0.28 },
          { name: 'Ø108×4', ptm: 4.0, perimeter: 340, areaPerMeter: 0.34 },
          { name: 'Ø133×5', ptm: 5.0, perimeter: 418, areaPerMeter: 0.42 },
          { name: 'Ø159×6', ptm: 6.0, perimeter: 500, areaPerMeter: 0.5 },
          { name: 'Ø219×8', ptm: 8.0, perimeter: 688, areaPerMeter: 0.69 },
          { name: 'Ø273×10', ptm: 10.0, perimeter: 858, areaPerMeter: 0.86 }
        ]
      },
      
      'corner': {
        name: 'Уголок',
        sizes: [
          // ГОСТ 8509-93 и ГОСТ 8510-86
          { name: '20 x 20 x 3', ptm: 1.459, perimeter: 77.468, areaPerMeter: 0.077 },
          { name: '30 x 30 x 4', ptm: 1.935, perimeter: 117.167, areaPerMeter: 0.117 },
          { name: '40 x 40 x 5', ptm: 2.424, perimeter: 156.395, areaPerMeter: 0.156 },
          { name: '50 x 50 x 6', ptm: 2.902, perimeter: 196.094, areaPerMeter: 0.196 },
          { name: '70 x 70 x 8', ptm: 3.889, perimeter: 274.249, areaPerMeter: 0.274 },
          { name: '100 x 100 x 16', ptm: 7.583, perimeter: 391.416, areaPerMeter: 0.391 },
          { name: '200 x 200 x 30', ptm: 14.171, perimeter: 787.124, areaPerMeter: 0.787 }
        ]
      }
    };

    // Таблицы расхода
    const VM_CONSUMPTION_TABLE = [
      { ptm: 1.0, R15: { thickness: 0.45, consumption: 0.74 }, R30: { thickness: 0.80, consumption: 1.32 }, R45: null, R60: null },
      { ptm: 1.5, R15: { thickness: 0.41, consumption: 0.68 }, R30: { thickness: 0.75, consumption: 1.24 }, R45: null, R60: null },
      { ptm: 2.0, R15: { thickness: 0.38, consumption: 0.63 }, R30: { thickness: 0.70, consumption: 1.16 }, R45: null, R60: null },
      { ptm: 2.4, R15: { thickness: 0.35, consumption: 0.62 }, R30: { thickness: 0.65, consumption: 1.15 }, R45: { thickness: 0.90, consumption: 1.53 }, R60: null },
      { ptm: 2.5, R15: { thickness: 0.33, consumption: 0.54 }, R30: { thickness: 0.61, consumption: 1.01 }, R45: { thickness: 0.81, consumption: 1.34 }, R60: null },
      { ptm: 2.9, R15: { thickness: 0.32, consumption: 0.53 }, R30: { thickness: 0.57, consumption: 0.94 }, R45: { thickness: 0.75, consumption: 1.28 }, R60: { thickness: 1.25, consumption: 2.06 }},
      { ptm: 3.4, R15: { thickness: 0.31, consumption: 0.51 }, R30: { thickness: 0.51, consumption: 0.84 }, R45: { thickness: 0.73, consumption: 1.24 }, R60: { thickness: 1.16, consumption: 2.05 }},
      { ptm: 3.8, R15: { thickness: 0.27, consumption: 0.45 }, R30: { thickness: 0.47, consumption: 0.78 }, R45: { thickness: 0.64, consumption: 1.06 }, R60: { thickness: 1.04, consumption: 1.72 }},
      { ptm: 4.1, R15: { thickness: 0.25, consumption: 0.41 }, R30: { thickness: 0.44, consumption: 0.73 }, R45: { thickness: 0.61, consumption: 1.01 }, R60: { thickness: 0.96, consumption: 1.58 }},
      { ptm: 4.4, R15: { thickness: 0.22, consumption: 0.36 }, R30: { thickness: 0.42, consumption: 0.69 }, R45: { thickness: 0.56, consumption: 0.92 }, R60: { thickness: 0.89, consumption: 1.47 }},
      { ptm: 4.7, R15: { thickness: 0.21, consumption: 0.35 }, R30: { thickness: 0.39, consumption: 0.64 }, R45: { thickness: 0.53, consumption: 0.87 }, R60: { thickness: 0.84, consumption: 1.39 }},
      { ptm: 5.0, R15: { thickness: 0.20, consumption: 0.33 }, R30: { thickness: 0.36, consumption: 0.59 }, R45: { thickness: 0.49, consumption: 0.81 }, R60: { thickness: 0.78, consumption: 1.29 }},
      { ptm: 5.3, R15: { thickness: 0.20, consumption: 0.33 }, R30: { thickness: 0.34, consumption: 0.56 }, R45: { thickness: 0.46, consumption: 0.76 }, R60: { thickness: 0.74, consumption: 1.22 }},
      { ptm: 5.6, R15: { thickness: 0.20, consumption: 0.33 }, R30: { thickness: 0.32, consumption: 0.53 }, R45: { thickness: 0.44, consumption: 0.73 }, R60: { thickness: 0.70, consumption: 1.16 }},
      { ptm: 5.8, R15: { thickness: 0.20, consumption: 0.33 }, R30: { thickness: 0.30, consumption: 0.50 }, R45: { thickness: 0.42, consumption: 0.69 }, R60: { thickness: 0.67, consumption: 1.11 }},
      { ptm: 6.3, R15: { thickness: 0.20, consumption: 0.33 }, R30: { thickness: 0.28, consumption: 0.46 }, R45: { thickness: 0.39, consumption: 0.64 }, R60: { thickness: 0.64, consumption: 1.06 }},
      { ptm: 6.6, R15: { thickness: 0.20, consumption: 0.33 }, R30: { thickness: 0.27, consumption: 0.45 }, R45: { thickness: 0.37, consumption: 0.61 }, R60: { thickness: 0.61, consumption: 1.01 }},
      { ptm: 6.9, R15: { thickness: 0.20, consumption: 0.33 }, R30: { thickness: 0.27, consumption: 0.45 }, R45: { thickness: 0.35, consumption: 0.58 }, R60: { thickness: 0.59, consumption: 0.97 }},
      { ptm: 7.2, R15: { thickness: 0.20, consumption: 0.33 }, R30: { thickness: 0.27, consumption: 0.45 }, R45: { thickness: 0.33, consumption: 0.54 }, R60: { thickness: 0.57, consumption: 0.94 }},
      { ptm: 7.4, R15: { thickness: 0.20, consumption: 0.33 }, R30: { thickness: 0.27, consumption: 0.45 }, R45: { thickness: 0.32, consumption: 0.53 }, R60: { thickness: 0.55, consumption: 0.91 }},
      { ptm: 7.7, R15: { thickness: 0.20, consumption: 0.33 }, R30: { thickness: 0.27, consumption: 0.45 }, R45: { thickness: 0.31, consumption: 0.51 }, R60: { thickness: 0.54, consumption: 0.89 }},
      { ptm: 8.0, R15: { thickness: 0.20, consumption: 0.33 }, R30: { thickness: 0.26, consumption: 0.43 }, R45: { thickness: 0.30, consumption: 0.50 }, R60: { thickness: 0.52, consumption: 0.86 }},
      { ptm: 8.3, R15: { thickness: 0.20, consumption: 0.33 }, R30: { thickness: 0.26, consumption: 0.43 }, R45: { thickness: 0.29, consumption: 0.48 }, R60: { thickness: 0.51, consumption: 0.84 }},
      { ptm: 8.5, R15: { thickness: 0.20, consumption: 0.33 }, R30: { thickness: 0.26, consumption: 0.43 }, R45: { thickness: 0.28, consumption: 0.46 }, R60: { thickness: 0.50, consumption: 0.83 }},
      { ptm: 8.9, R15: { thickness: 0.20, consumption: 0.33 }, R30: { thickness: 0.26, consumption: 0.43 }, R45: { thickness: 0.28, consumption: 0.46 }, R60: { thickness: 0.48, consumption: 0.79 }},
      { ptm: 9.2, R15: { thickness: 0.20, consumption: 0.33 }, R30: { thickness: 0.26, consumption: 0.43 }, R45: { thickness: 0.27, consumption: 0.45 }, R60: { thickness: 0.47, consumption: 0.78 }},
      { ptm: 9.5, R15: { thickness: 0.20, consumption: 0.33 }, R30: { thickness: 0.26, consumption: 0.43 }, R45: { thickness: 0.27, consumption: 0.45 }, R60: { thickness: 0.45, consumption: 0.74 }},
      { ptm: 9.8, R15: { thickness: 0.20, consumption: 0.33 }, R30: { thickness: 0.26, consumption: 0.43 }, R45: { thickness: 0.27, consumption: 0.45 }, R60: { thickness: 0.44, consumption: 0.73 }},
      { ptm: 10.1, R15: { thickness: 0.20, consumption: 0.33 }, R30: { thickness: 0.26, consumption: 0.43 }, R45: { thickness: 0.27, consumption: 0.45 }, R60: { thickness: 0.43, consumption: 0.71 }},
      { ptm: 10.4, R15: { thickness: 0.20, consumption: 0.33 }, R30: { thickness: 0.26, consumption: 0.43 }, R45: { thickness: 0.27, consumption: 0.45 }, R60: { thickness: 0.41, consumption: 0.68 }},
      { ptm: 10.7, R15: { thickness: 0.20, consumption: 0.33 }, R30: { thickness: 0.26, consumption: 0.43 }, R45: { thickness: 0.27, consumption: 0.45 }, R60: { thickness: 0.39, consumption: 0.64 }},
      { ptm: 11.0, R15: { thickness: 0.20, consumption: 0.33 }, R30: { thickness: 0.26, consumption: 0.43 }, R45: { thickness: 0.27, consumption: 0.45 }, R60: { thickness: 0.38, consumption: 0.63 }},
      { ptm: 11.3, R15: { thickness: 0.20, consumption: 0.33 }, R30: { thickness: 0.26, consumption: 0.43 }, R45: { thickness: 0.27, consumption: 0.45 }, R60: { thickness: 0.37, consumption: 0.61 }},
      { ptm: 11.6, R15: { thickness: 0.20, consumption: 0.33 }, R30: { thickness: 0.26, consumption: 0.43 }, R45: { thickness: 0.27, consumption: 0.45 }, R60: { thickness: 0.35, consumption: 0.58 }},
      { ptm: 11.9, R15: { thickness: 0.20, consumption: 0.33 }, R30: { thickness: 0.26, consumption: 0.43 }, R45: { thickness: 0.27, consumption: 0.45 }, R60: { thickness: 0.34, consumption: 0.56 }},
      { ptm: 12.3, R15: { thickness: 0.20, consumption: 0.33 }, R30: { thickness: 0.25, consumption: 0.43 }, R45: { thickness: 0.25, consumption: 0.42 }, R60: { thickness: 0.32, consumption: 0.53 }},
      { ptm: 12.5, R15: { thickness: 0.20, consumption: 0.33 }, R30: { thickness: 0.25, consumption: 0.43 }, R45: { thickness: 0.24, consumption: 0.40 }, R60: { thickness: 0.31, consumption: 0.51 }},
      { ptm: 13.0, R15: { thickness: 0.20, consumption: 0.33 }, R30: { thickness: 0.23, consumption: 0.38 }, R45: { thickness: 0.24, consumption: 0.40 }, R60: { thickness: 0.30, consumption: 0.50 }},
      { ptm: 13.5, R15: { thickness: 0.20, consumption: 0.33 }, R30: { thickness: 0.23, consumption: 0.38 }, R45: { thickness: 0.24, consumption: 0.40 }, R60: { thickness: 0.30, consumption: 0.50 }},
      { ptm: 14.0, R15: { thickness: 0.20, consumption: 0.33 }, R30: { thickness: 0.23, consumption: 0.38 }, R45: { thickness: 0.24, consumption: 0.40 }, R60: { thickness: 0.30, consumption: 0.50 }},
      { ptm: 15.0, R15: { thickness: 0.20, consumption: 0.33 }, R30: { thickness: 0.23, consumption: 0.38 }, R45: { thickness: 0.24, consumption: 0.40 }, R60: { thickness: 0.29, consumption: 0.48 }},
      { ptm: 16.0, R15: { thickness: 0.20, consumption: 0.33 }, R30: { thickness: 0.23, consumption: 0.38 }, R45: { thickness: 0.24, consumption: 0.40 }, R60: { thickness: 0.29, consumption: 0.48 }},
      { ptm: 17.0, R15: { thickness: 0.20, consumption: 0.33 }, R30: { thickness: 0.23, consumption: 0.38 }, R45: { thickness: 0.24, consumption: 0.40 }, R60: { thickness: 0.28, consumption: 0.46 }},
      { ptm: 18.0, R15: { thickness: 0.20, consumption: 0.33 }, R30: { thickness: 0.23, consumption: 0.38 }, R45: { thickness: 0.23, consumption: 0.38 }, R60: { thickness: 0.28, consumption: 0.46 }}
    ];

    const KONSTRUKTIV_METAL_TABLE = [
      { ptm: 2.0, R90: { konstruktiv: 4.90, vm: 1.10, total: 6.00 }, R120: null },
      { ptm: 2.1, R90: { konstruktiv: 4.84, vm: 1.09, total: 5.94 }, R120: null },
      { ptm: 2.2, R90: { konstruktiv: 4.79, vm: 1.09, total: 5.87 }, R120: null },
      { ptm: 2.3, R90: { konstruktiv: 4.73, vm: 1.08, total: 5.81 }, R120: null },
      { ptm: 2.4, R90: { konstruktiv: 4.67, vm: 1.07, total: 5.74 }, R120: null },
      { ptm: 2.5, R90: { konstruktiv: 4.61, vm: 1.06, total: 5.68 }, R120: { konstruktiv: 5.20, vm: 2.40, total: 7.60 }},
      { ptm: 2.6, R90: { konstruktiv: 4.56, vm: 1.06, total: 5.61 }, R120: { konstruktiv: 5.14, vm: 2.38, total: 7.52 }},
      { ptm: 2.7, R90: { konstruktiv: 4.50, vm: 1.05, total: 5.55 }, R120: { konstruktiv: 5.09, vm: 2.36, total: 7.44 }},
      { ptm: 2.8, R90: { konstruktiv: 4.44, vm: 1.04, total: 5.49 }, R120: { konstruktiv: 5.03, vm: 2.33, total: 7.37 }},
      { ptm: 2.9, R90: { konstruktiv: 4.39, vm: 1.04, total: 5.42 }, R120: { konstruktiv: 4.98, vm: 2.31, total: 7.29 }},
      { ptm: 3.0, R90: { konstruktiv: 4.33, vm: 1.03, total: 5.36 }, R120: { konstruktiv: 4.92, vm: 2.29, total: 7.21 }},
      { ptm: 3.1, R90: { konstruktiv: 4.27, vm: 1.02, total: 5.29 }, R120: { konstruktiv: 4.87, vm: 2.27, total: 7.13 }},
      { ptm: 3.2, R90: { konstruktiv: 4.21, vm: 1.01, total: 5.23 }, R120: { konstruktiv: 4.81, vm: 2.24, total: 7.06 }},
      { ptm: 3.3, R90: { konstruktiv: 4.16, vm: 1.01, total: 5.16 }, R120: { konstruktiv: 4.76, vm: 2.22, total: 6.98 }},
      { ptm: 3.4, R90: { konstruktiv: 4.10, vm: 1.00, total: 5.10 }, R120: { konstruktiv: 4.70, vm: 2.20, total: 6.90 }},
      { ptm: 3.5, R90: { konstruktiv: 4.04, vm: 0.98, total: 5.02 }, R120: { konstruktiv: 4.62, vm: 2.15, total: 6.77 }},
      { ptm: 3.6, R90: { konstruktiv: 3.98, vm: 0.95, total: 4.93 }, R120: { konstruktiv: 4.53, vm: 2.10, total: 6.63 }},
      { ptm: 3.7, R90: { konstruktiv: 3.93, vm: 0.92, total: 4.85 }, R120: { konstruktiv: 4.45, vm: 2.05, total: 6.50 }},
      { ptm: 3.8, R90: { konstruktiv: 3.87, vm: 0.90, total: 4.77 }, R120: { konstruktiv: 4.37, vm: 2.00, total: 6.37 }},
      { ptm: 3.9, R90: { konstruktiv: 3.81, vm: 0.87, total: 4.68 }, R120: { konstruktiv: 4.28, vm: 1.95, total: 6.23 }},
      { ptm: 4.0, R90: { konstruktiv: 3.75, vm: 0.85, total: 4.60 }, R120: { konstruktiv: 4.20, vm: 1.90, total: 6.10 }},
      { ptm: 4.1, R90: { konstruktiv: 3.69, vm: 0.82, total: 4.52 }, R120: { konstruktiv: 4.12, vm: 1.85, total: 5.97 }},
      { ptm: 4.2, R90: { konstruktiv: 3.63, vm: 0.80, total: 4.43 }, R120: { konstruktiv: 4.03, vm: 1.80, total: 5.83 }},
      { ptm: 4.3, R90: { konstruktiv: 3.58, vm: 0.77, total: 4.35 }, R120: { konstruktiv: 4.05, vm: 1.75, total: 5.70 }},
      { ptm: 4.4, R90: { konstruktiv: 3.52, vm: 0.75, total: 4.27 }, R120: { konstruktiv: 3.87, vm: 1.70, total: 5.57 }},
      { ptm: 4.5, R90: { konstruktiv: 3.46, vm: 0.72, total: 4.18 }, R120: { konstruktiv: 3.78, vm: 1.65, total: 5.43 }},
      { ptm: 4.6, R90: { konstruktiv: 3.40, vm: 0.70, total: 4.10 }, R120: { konstruktiv: 3.70, vm: 1.60, total: 5.30 }},
      { ptm: 4.7, R90: { konstruktiv: 3.34, vm: 0.67, total: 4.02 }, R120: { konstruktiv: 3.62, vm: 1.55, total: 5.17 }},
      { ptm: 4.8, R90: { konstruktiv: 3.28, vm: 0.65, total: 3.93 }, R120: { konstruktiv: 3.53, vm: 1.50, total: 5.03 }},
      { ptm: 4.9, R90: { konstruktiv: 3.23, vm: 0.62, total: 3.85 }, R120: { konstruktiv: 3.45, vm: 1.45, total: 4.90 }},
      { ptm: 5.0, R90: { konstruktiv: 3.17, vm: 0.60, total: 3.77 }, R120: { konstruktiv: 3.37, vm: 1.40, total: 4.77 }},
      { ptm: 5.1, R90: { konstruktiv: 3.11, vm: 0.57, total: 3.68 }, R120: { konstruktiv: 3.28, vm: 1.35, total: 4.63 }},
      { ptm: 5.2, R90: { konstruktiv: 3.05, vm: 0.55, total: 3.60 }, R120: { konstruktiv: 3.20, vm: 1.30, total: 4.50 }},
      { ptm: 5.3, R90: { konstruktiv: 2.99, vm: 0.52, total: 3.52 }, R120: { konstruktiv: 3.12, vm: 1.25, total: 4.37 }},
      { ptm: 5.4, R90: { konstruktiv: 2.93, vm: 0.50, total: 3.43 }, R120: { konstruktiv: 3.03, vm: 1.20, total: 4.23 }},
      { ptm: 5.5, R90: { konstruktiv: 2.88, vm: 0.48, total: 3.35 }, R120: { konstruktiv: 2.95, vm: 1.15, total: 4.10 }},
      { ptm: 5.6, R90: { konstruktiv: 2.82, vm: 0.45, total: 3.27 }, R120: { konstruktiv: 2.87, vm: 1.10, total: 3.97 }},
      { ptm: 5.7, R90: { konstruktiv: 2.76, vm: 0.43, total: 3.18 }, R120: { konstruktiv: 2.78, vm: 1.05, total: 3.83 }},
      { ptm: 5.8, R90: { konstruktiv: 2.70, vm: 0.40, total: 3.10 }, R120: { konstruktiv: 2.70, vm: 1.00, total: 3.70 }}
    ];

    const VM_HIGH_PTM_TABLE = [
      { ptm: 5.8, R90: { thickness: 1.25, consumption: 2.06 }, R120: { thickness: 2.30, consumption: 3.79 }},
      { ptm: 6.3, R90: { thickness: 1.08, consumption: 1.78 }, R120: { thickness: 2.26, consumption: 3.73 }},
      { ptm: 6.6, R90: { thickness: 1.00, consumption: 1.65 }, R120: { thickness: 2.20, consumption: 3.63 }},
      { ptm: 6.9, R90: { thickness: 0.95, consumption: 1.57 }, R120: { thickness: 2.12, consumption: 3.50 }},
      { ptm: 7.2, R90: { thickness: 0.90, consumption: 1.49 }, R120: { thickness: 2.08, consumption: 3.43 }},
      { ptm: 7.4, R90: { thickness: 0.85, consumption: 1.40 }, R120: { thickness: 2.00, consumption: 3.30 }},
      { ptm: 7.7, R90: { thickness: 0.81, consumption: 1.34 }, R120: { thickness: 1.90, consumption: 3.14 }},
      { ptm: 8.0, R90: { thickness: 0.78, consumption: 1.29 }, R120: { thickness: 1.80, consumption: 2.97 }},
      { ptm: 8.3, R90: { thickness: 0.77, consumption: 1.27 }, R120: { thickness: 1.74, consumption: 2.87 }},
      { ptm: 8.5, R90: { thickness: 0.75, consumption: 1.24 }, R120: { thickness: 1.70, consumption: 2.80 }},
      { ptm: 8.9, R90: { thickness: 0.72, consumption: 1.19 }, R120: { thickness: 1.65, consumption: 2.72 }},
      { ptm: 9.2, R90: { thickness: 0.70, consumption: 1.16 }, R120: { thickness: 1.58, consumption: 2.61 }},
      { ptm: 9.5, R90: { thickness: 0.67, consumption: 1.11 }, R120: { thickness: 1.50, consumption: 2.48 }},
      { ptm: 9.8, R90: { thickness: 0.65, consumption: 1.07 }, R120: { thickness: 1.42, consumption: 2.34 }},
      { ptm: 10.1, R90: { thickness: 0.64, consumption: 1.06 }, R120: { thickness: 1.38, consumption: 2.28 }},
      { ptm: 10.4, R90: { thickness: 0.62, consumption: 1.02 }, R120: { thickness: 1.34, consumption: 2.21 }},
      { ptm: 10.7, R90: { thickness: 0.60, consumption: 0.99 }, R120: { thickness: 1.30, consumption: 2.15 }},
      { ptm: 11.0, R90: { thickness: 0.58, consumption: 0.96 }, R120: { thickness: 1.25, consumption: 2.06 }},
      { ptm: 11.3, R90: { thickness: 0.55, consumption: 0.91 }, R120: { thickness: 1.20, consumption: 1.98 }},
      { ptm: 11.6, R90: { thickness: 0.53, consumption: 0.87 }, R120: { thickness: 1.15, consumption: 1.90 }},
      { ptm: 11.9, R90: { thickness: 0.50, consumption: 0.83 }, R120: { thickness: 1.10, consumption: 1.82 }},
      { ptm: 12.3, R90: { thickness: 0.47, consumption: 0.80 }, R120: { thickness: 1.06, consumption: 1.75 }},
      { ptm: 12.5, R90: { thickness: 0.45, consumption: 0.74 }, R120: { thickness: 1.01, consumption: 1.67 }},
      { ptm: 13.0, R90: { thickness: 0.42, consumption: 0.69 }, R120: { thickness: 0.97, consumption: 1.60 }},
      { ptm: 13.5, R90: { thickness: 0.40, consumption: 0.66 }, R120: { thickness: 0.93, consumption: 1.53 }},
      { ptm: 14.0, R90: { thickness: 0.38, consumption: 0.63 }, R120: { thickness: 0.87, consumption: 1.44 }},
      { ptm: 15.0, R90: { thickness: 0.34, consumption: 0.56 }, R120: { thickness: 0.82, consumption: 1.35 }},
      { ptm: 16.0, R90: { thickness: 0.32, consumption: 0.53 }, R120: { thickness: 0.76, consumption: 1.25 }},
      { ptm: 17.0, R90: { thickness: 0.30, consumption: 0.50 }, R120: { thickness: 0.70, consumption: 1.16 }},
      { ptm: 18.0, R90: { thickness: 0.30, consumption: 0.50 }, R120: { thickness: 0.65, consumption: 1.07 }}
    ];

    // Глобальные переменные
    let calculationHistory = JSON.parse(localStorage.getItem('nzsk_history') || '[]');
    let timerInterval = null;
    let timerSeconds = 0;
    let timerTotalSeconds = 0;
    let timerRunning = false;
    let lastCalculation = null;
    let incompatibleDetected = false;

    let currentCalcTab = 'manual';
    let currentProfileType = 'i-beam';
    let currentProfileSize = null;
    let currentFireResistance = 'R60';

    // Текущие значения кастомных select
    let currentCategory = "metal";
    let currentProduct = "vm";
    let currentSurface = "clean_metal";
    let currentTimerProduct = "vm";

    const SURFACE_LABELS = {
      clean_metal: "Чистый металл",
      galvanized: "Оцинковка",
      concrete: "Бетон",
      wood: "Древесина",
      gf021: "Грунтовка ГФ-021",
      dv106: "Грунтовка ДВ-106",
      other_lkm: "Другой ЛКМ / загрязнения"
    };

    // Инициализация при загрузке
    document.addEventListener('DOMContentLoaded', function() {
      loadHistory();
      updateTimerProductInfo();
      initCustomSelects();
      initProfileButtons();
      loadProfileSizes();
      updateProductOptions();
      
      // Добавляем обработчики для автоматического расчета площади
      document.getElementById('length').addEventListener('input', function() {
        if (currentCalcTab === 'manual') {
          updateAreaFromLength();
        }
      });
      
      // Инициализируем отображение расчетной площади
      updateAreaFromLength();
    });

    // ========== ФУНКЦИИ ДЛЯ КАЛЬКУЛЯТОРА РАСХОДА ==========
    
    // Функция для расчета площади из длины
    function updateAreaFromLength() {
      if (currentCalcTab !== 'manual') return;
      
      const length = parseFloat(document.getElementById('length').value);
      
      if (!length || length <= 0) {
        document.getElementById('calculatedAreaInfo').classList.add('hidden');
        return;
      }
      
      // Площадь равна длине (S = L)
      document.getElementById('calculatedAreaValue').textContent = length.toFixed(2);
      document.getElementById('calculatedAreaInfo').classList.remove('hidden');
      
      // Если площадь введена вручную, сравниваем с длиной
      const areaInput = document.getElementById('area').value;
      if (areaInput) {
        const manualArea = parseFloat(areaInput);
        const diff = Math.abs(length - manualArea);
        const diffPercent = (diff / length * 100).toFixed(1);
        
        if (diffPercent > 10) {
          document.getElementById('calculatedAreaInfo').innerHTML = 
            `<i class="fas fa-exclamation-triangle" style="color: var(--warning);"></i>
            <span>Используемая площадь: ${length.toFixed(2)} м² (S = L) (отличается на ${diffPercent}% от введенной площади)</span>`;
        } else {
          document.getElementById('calculatedAreaInfo').innerHTML = 
            `<i class="fas fa-check-circle" style="color: var(--success);"></i>
            <span>Используемая площадь: ${length.toFixed(2)} м² (S = L) (совпадает с введенной площадью)</span>`;
        }
      } else {
        document.getElementById('calculatedAreaInfo').innerHTML = 
          `<i class="fas fa-info-circle" style="color: var(--info);"></i>
          <span>Используемая площадь: ${length.toFixed(2)} м² (S = L)</span>`;
      }
    }

    function switchCalcTab(tabName) {
      currentCalcTab = tabName;
      
      document.querySelectorAll('.calc-content').forEach(tab => {
        tab.classList.remove('active');
      });
      
      document.querySelectorAll('.calc-tab').forEach(tab => {
        tab.classList.remove('active');
      });
      
      document.getElementById(tabName).classList.add('active');
      event.currentTarget.classList.add('active');
      
      if (tabName === 'profiles') {
        loadProfileSizes();
      } else if (tabName === 'manual') {
        updateAreaFromLength();
      }
    }

    function initProfileButtons() {
      const profileButtons = document.querySelectorAll('.profile-type-btn');
      
      profileButtons.forEach(button => {
        button.addEventListener('click', function() {
          const type = this.getAttribute('data-type');
          
          profileButtons.forEach(btn => btn.classList.remove('active'));
          this.classList.add('active');
          
          currentProfileType = type;
          currentProfileSize = null;
          
          loadProfileSizes();
          
          document.getElementById('selected-size-info').classList.add('hidden');
        });
      });
    }

    function loadProfileSizes() {
      if (currentCalcTab !== 'profiles') return;
      
      const profileData = PROFILES_DATA[currentProfileType];
      const sizeOptions = document.getElementById('size-options');
      
      if (!profileData || !sizeOptions) return;
      
      sizeOptions.innerHTML = '';
      
      profileData.sizes.forEach((size, index) => {
        const sizeOption = document.createElement('div');
        sizeOption.className = 'size-option';
        
        let displayText = size.name;
        if (size.ptm) displayText += ` (ПТМ: ${size.ptm} мм)`;
        if (size.areaPerMeter) displayText += `, Площадь: ${size.areaPerMeter} м²/м.п.`;
        
        sizeOption.textContent = displayText;
        sizeOption.setAttribute('data-index', index);
        
        if (index === 0) {
          sizeOption.classList.add('selected');
          currentProfileSize = size;
          updateSelectedSizeInfo(size);
        }
        
        sizeOption.addEventListener('click', function() {
          document.querySelectorAll('.size-option').forEach(opt => {
            opt.classList.remove('selected');
          });
          this.classList.add('selected');
          
          const sizeIndex = parseInt(this.getAttribute('data-index'));
          currentProfileSize = profileData.sizes[sizeIndex];
          
          updateSelectedSizeInfo(currentProfileSize);
        });
        
        sizeOptions.appendChild(sizeOption);
      });
    }

    function updateSelectedSizeInfo(size) {
      const infoDiv = document.getElementById('selected-size-info');
      infoDiv.classList.remove('hidden');
      
      document.getElementById('selected-size-name').textContent = size.name;
      document.getElementById('selected-size-ptm').textContent = size.ptm || '-';
      document.getElementById('selected-size-perimeter').textContent = size.perimeter || '-';
      document.getElementById('selected-size-areaPerMeter').textContent = size.areaPerMeter || '-';
    }

    function findNearestPTM(ptm, table) {
      let nearest = table[0];
      let minDiff = Math.abs(ptm - table[0].ptm);
      
      for (let i = 1; i < table.length; i++) {
        const diff = Math.abs(ptm - table[i].ptm);
        if (diff < minDiff) {
          minDiff = diff;
          nearest = table[i];
        }
      }
      
      return nearest;
    }

    function calculateMaterial() {
      let ptm, totalArea, length;
      
      if (currentCalcTab === 'manual') {
        ptm = parseFloat(document.getElementById('ptm').value);
        length = parseFloat(document.getElementById('length').value);
        
        if (!ptm || ptm < 1.0 || ptm > 18.0) {
          showNotification('Введите корректную ПТМ (1.0-18.0 мм)', 'error');
          return;
        }
        
        if (!length || length <= 0) {
          showNotification('Введите длину конструкций', 'error');
          return;
        }
        
        // ВАЖНОЕ ИЗМЕНЕНИЕ: Площадь всегда равна длине (S = L)
        totalArea = length;
        
        // Показываем предупреждение, если пользователь ввел площадь вручную
        const inputArea = document.getElementById('area').value;
        if (inputArea) {
          const manualArea = parseFloat(inputArea);
          const diff = Math.abs(totalArea - manualArea);
          const diffPercent = (diff / totalArea * 100);
          
          if (diffPercent > 10) {
            showNotification(`Внимание: Площадь рассчитана как длина (S = L = ${length} м). Введенная площадь (${manualArea} м²) проигнорирована.`, 'warning');
          } else {
            showNotification(`Площадь рассчитана как длина (S = L = ${length} м). Введенная площадь совпадает.`, 'success');
          }
        } else {
          showNotification(`Площадь рассчитана как длина (S = L = ${length} м)`, 'success');
        }
      } 
      else if (currentCalcTab === 'profiles') {
        if (!currentProfileSize) {
          showNotification('Выберите размер профиля', 'error');
          return;
        }
        
        ptm = currentProfileSize.ptm;
        length = parseFloat(document.getElementById('profile-length').value);
        
        if (!length || length <= 0) {
          showNotification('Введите длину профиля', 'error');
          return;
        }
        
        // ВАЖНОЕ ИЗМЕНЕНИЕ: Для профилей тоже используем S = L
        // Игнорируем areaPerMeter, используем только длину
        totalArea = length;
      }
      
      if (!totalArea || totalArea <= 0) {
        showNotification('Не удалось рассчитать площадь', 'error');
        return;
      }
      
      const fireResistance = currentFireResistance;
      let systemType = '';
      let calculationData = null;
      let isSystem = false;
      
      if (fireResistance === 'R15' || fireResistance === 'R30' || 
          fireResistance === 'R45' || fireResistance === 'R60') {
        systemType = 'Спец-ВМ';
        const tableData = findNearestPTM(ptm, VM_CONSUMPTION_TABLE);
        calculationData = tableData[fireResistance];
        
        if (!calculationData) {
          showNotification(`Для ПТМ ${ptm} мм и огнестойкости ${fireResistance} данные не найдены`, 'warning');
          return;
        }
      } 
      else if (fireResistance === 'R90' || fireResistance === 'R120') {
        if (ptm < 5.8) {
          systemType = 'Конструктив-Металл';
          isSystem = true;
          const tableData = findNearestPTM(ptm, KONSTRUKTIV_METAL_TABLE);
          calculationData = tableData[fireResistance];
          
          if (!calculationData) {
            showNotification(`Для ПТМ ${ptm} мм и огнестойкости ${fireResistance} данные не найдены`, 'warning');
            return;
          }
        } else {
          systemType = 'Спец-ВМ';
          const tableData = findNearestPTM(ptm, VM_HIGH_PTM_TABLE);
          calculationData = tableData[fireResistance];
          
          if (!calculationData) {
            showNotification(`Для ПТМ ${ptm} мм и огнестойкости ${fireResistance} данные не найдены`, 'warning');
            return;
          }
        }
      }
      
      let totalConsumption = 0;
      let totalKg = 0;
      let buckets = { konstruktiv: 0, vm: 0, total: 0 };
      
      if (isSystem) {
        const konstruktivThickness = calculationData.konstruktiv;
        const vmThickness = calculationData.vm;
        const konstruktivConsumption = konstruktivThickness * 1.35;
        const vmConsumption = vmThickness * 1.65;
        totalConsumption = konstruktivConsumption + vmConsumption;
        totalKg = totalConsumption * totalArea;
        
        const konstruktivKg = konstruktivConsumption * totalArea;
        const vmKg = vmConsumption * totalArea;
        buckets.konstruktiv = Math.ceil(konstruktivKg / 18);
        buckets.vm = Math.ceil(vmKg / 25);
        buckets.total = buckets.konstruktiv + buckets.vm;
      } else {
        totalConsumption = calculationData.consumption;
        totalKg = totalConsumption * totalArea;
        buckets.vm = Math.ceil(totalKg / 25);
        buckets.total = buckets.vm;
      }
      
      displayResults({
        ptm: ptm,
        length: length,
        fireResistance: fireResistance,
        totalArea: totalArea.toFixed(2),
        systemType: systemType,
        calculationData: calculationData,
        isSystem: isSystem,
        totalConsumption: totalConsumption,
        totalKg: totalKg.toFixed(1),
        buckets: buckets
      });
      
      document.getElementById('calcResultStatus').textContent = '✓ Рассчитано';
      document.getElementById('calcResultStatus').className = 'status-badge status-success';
      
      showNotification('Расчет выполнен успешно', 'success');
    }

    function displayResults(data) {
      const calcResults = document.getElementById('calcResults');
      const detailedCalculation = document.getElementById('detailedCalculation');
      const packingInfo = document.getElementById('packingInfo');
      const technicalInfo = document.getElementById('technicalInfo');
      
      let resultsHTML = `
        <div class="result-item success">
          <div class="mb-10"><i class="fas fa-calculator"></i> <b>Результаты расчета:</b></div>
          
          <div class="info-cards mt-15">
            <div class="info-card">
              <div class="info-card-title">
                <i class="fas fa-ruler"></i>ПТМ
              </div>
              <div class="info-card-value">${data.ptm}</div>
              <div class="info-card-unit">мм</div>
            </div>
            
            <div class="info-card">
              <div class="info-card-title">
                <i class="fas fa-ruler-vertical"></i>Длина
              </div>
              <div class="info-card-value">${data.length}</div>
              <div class="info-card-unit">м</div>
            </div>
            
            <div class="info-card">
              <div class="info-card-title">
                <i class="fas fa-ruler-combined"></i>Площадь (S = L)
              </div>
              <div class="info-card-value">${data.totalArea}</div>
              <div class="info-card-unit">м²</div>
            </div>
            
            <div class="info-card">
              <div class="info-card-title">
                <i class="fas fa-fire"></i>Огнестойкость
              </div>
              <div class="info-card-value">${data.fireResistance}</div>
              <div class="info-card-unit">минут</div>
            </div>
            
            <div class="info-card">
              <div class="info-card-title">
                <i class="fas fa-layer-group"></i>Система
              </div>
              <div class="info-card-value">${data.systemType}</div>
              <div class="info-card-unit">${data.isSystem ? 'комбинированная' : 'однослойная'}</div>
            </div>
          </div>
          
          <div class="mt-15">
            <div><b>Общий расход материала:</b> ${data.totalKg} кг</div>
            <div><b>Расход на 1 м²:</b> ${data.totalConsumption.toFixed(2)} кг/м²</div>
            <div><b>Принцип расчета:</b> Площадь = Длина (S = L = ${data.length} м)</div>
          </div>
        </div>
      `;
      
      calcResults.innerHTML = resultsHTML;
      
      let detailedHTML = '';
      if (data.isSystem) {
        const konstruktivThickness = data.calculationData.konstruktiv;
        const vmThickness = data.calculationData.vm;
        const totalThickness = data.calculationData.total;
        const konstruktivConsumption = konstruktivThickness * 1.35;
        const vmConsumption = vmThickness * 1.65;
        const konstruktivKg = (konstruktivConsumption * parseFloat(data.totalArea)).toFixed(1);
        const vmKg = (vmConsumption * parseFloat(data.totalArea)).toFixed(1);
        
        detailedHTML = `
          <div class="result-item info">
            <div class="mb-10"><i class="fas fa-boxes"></i> <b>Детализация системы "Конструктив-Металл":</b></div>
            
            <div style="overflow-x: auto;">
              <table class="size-table">
                <thead>
                  <tr>
                    <th>Компонент</th>
                    <th>Толщина, мм</th>
                    <th>Расход на 1 м², кг</th>
                    <th>Общий расход, кг</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td style="font-weight: 600;">Спец-Конструктив</td>
                    <td>${konstruktivThickness.toFixed(2)}</td>
                    <td>${konstruktivConsumption.toFixed(2)}</td>
                    <td>${konstruktivKg}</td>
                  </tr>
                  <tr>
                    <td style="font-weight: 600;">Спец-ВМ</td>
                    <td>${vmThickness.toFixed(2)}</td>
                    <td>${vmConsumption.toFixed(2)}</td>
                    <td>${vmKg}</td>
                  </tr>
                  <tr>
                    <td style="font-weight: 800;">Итого система</td>
                    <td>${totalThickness.toFixed(2)}</td>
                    <td>${data.totalConsumption.toFixed(2)}</td>
                    <td style="font-weight: 800;">${data.totalKg}</td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        `;
      } else {
        detailedHTML = `
          <div class="result-item info">
            <div class="mb-10"><i class="fas fa-box"></i> <b>Детализация материала "Спец-ВМ":</b></div>
            
            <div class="info-cards mt-15">
              <div class="info-card">
                <div class="info-card-title">
                  <i class="fas fa-ruler"></i>Толщина
                </div>
                <div class="info-card-value">${data.calculationData.thickness.toFixed(2)}</div>
                <div class="info-card-unit">мм</div>
              </div>
              
              <div class="info-card">
                <div class="info-card-title">
                  <i class="fas fa-weight"></i>Расход на 1 м²
                </div>
                <div class="info-card-value">${data.calculationData.consumption.toFixed(2)}</div>
                <div class="info-card-unit">кг/м²</div>
              </div>
            </div>
            <div class="mt-10">
              <i class="fas fa-info-circle"></i> <small>Расчет выполнен по принципу: Площадь = Длина (S = L = ${data.length} м)</small>
            </div>
          </div>
        `;
      }
      
      detailedCalculation.innerHTML = detailedHTML;
      detailedCalculation.classList.remove('hidden');
      
      let packingHTML = '';
      if (data.isSystem) {
        packingHTML = `
          <div class="result-item warning">
            <div class="mb-10"><i class="fas fa-box-open"></i> <b>Рекомендуемая упаковка:</b></div>
            
            <div class="info-cards mt-15">
              <div class="info-card">
                <div class="info-card-title">
                  <i class="fas fa-paint-roller"></i>Спец-Конструктив
                </div>
                <div class="info-card-value">${data.buckets.konstruktiv}</div>
                <div class="info-card-unit">ведра по 18 кг</div>
              </div>
              
              <div class="info-card">
                <div class="info-card-title">
                  <i class="fas fa-paint-roller"></i>Спец-ВМ
                </div>
                <div class="info-card-value">${data.buckets.vm}</div>
                <div class="info-card-unit">ведра по 25 кг</div>
              </div>
              
              <div class="info-card">
                <div class="info-card-title">
                  <i class="fas fa-boxes"></i>Всего ведер
                </div>
                <div class="info-card-value">${data.buckets.total}</div>
                <div class="info-card-unit">шт.</div>
              </div>
            </div>
          </div>
        `;
      } else {
        packingHTML = `
          <div class="result-item warning">
            <div class="mb-10"><i class="fas fa-box-open"></i> <b>Рекомендуемая упаковка:</b></div>
            
            <div class="info-cards mt-15">
              <div class="info-card">
                <div class="info-card-title">
                  <i class="fas fa-box"></i>Спец-ВМ
                </div>
                <div class="info-card-value">${data.buckets.vm}</div>
                <div class="info-card-unit">ведра по 25 кг</div>
              </div>
              
              <div class="info-card">
                <div class="info-card-title">
                  <i class="fas fa-weight"></i>Общий вес
                </div>
                <div class="info-card-value">${data.totalKg}</div>
                <div class="info-card-unit">кг</div>
              </div>
            </div>
          </div>
        `;
      }
      
      packingInfo.innerHTML = packingHTML;
      packingInfo.classList.remove('hidden');
      
      let techHTML = `
        <div class="result-item info">
          <div class="mb-10"><i class="fas fa-info-circle"></i> <b>Техническая информация:</b></div>
          
          <div style="font-size: 14px;">
            <div><b>Система покрытия:</b> ${data.systemType}</div>
            <div><b>Применение:</b> ${getApplicationInfo(data.ptm, data.fireResistance)}</div>
            <div><b>Температура нанесения:</b> +5...+40°C</div>
            <div><b>Влажность воздуха:</b> не более 80%</div>
            <div><b>Межслойная сушка:</b> 24 часа при 20°C</div>
            <div><b>Принцип расчета:</b> Площадь = Длина (S = L = ${data.length} м)</div>
          </div>
          
          <div class="mt-10" style="font-size: 13px; color: var(--nzsk-gray-dark);">
            <i class="fas fa-exclamation-circle"></i>
            Для точного подбора системы обратитесь к техническим специалистам НЗСК
          </div>
        </div>
      `;
      
      technicalInfo.innerHTML = techHTML;
      technicalInfo.classList.remove('hidden');
    }

    function getApplicationInfo(ptm, fireResistance) {
      if (fireResistance === 'R90' || fireResistance === 'R120') {
        if (ptm < 5.8) {
          return 'Комбинированная система (Спец-Конструктив + Спец-ВМ)';
        } else {
          return 'Однослойное покрытие Спец-ВМ';
        }
      } else {
        return 'Однослойное покрытие Спец-ВМ';
      }
    }

    function clearCalculator() {
      if (currentCalcTab === 'manual') {
        document.getElementById('ptm').value = '5.8';
        document.getElementById('length').value = '10';
        document.getElementById('area').value = '';
        document.getElementById('calculatedAreaInfo').classList.add('hidden');
      } else if (currentCalcTab === 'profiles') {
        document.getElementById('profile-length').value = '10';
        
        document.querySelectorAll('.profile-type-btn').forEach(btn => {
          btn.classList.remove('active');
        });
        document.querySelector('.profile-type-btn[data-type="i-beam"]').classList.add('active');
        currentProfileType = 'i-beam';
        
        document.querySelectorAll('.size-option').forEach(opt => {
          opt.classList.remove('selected');
        });
        currentProfileSize = null;
        document.getElementById('selected-size-info').classList.add('hidden');
        
        loadProfileSizes();
      }
      
      document.getElementById('calcResults').innerHTML = `
        <div class="text-center" style="padding: 40px 20px; color: var(--nzsk-gray-dark);">
          <i class="fas fa-calculator" style="font-size: 48px; margin-bottom: 15px; opacity: 0.3;"></i>
          <div style="font-size: 16px; font-weight: 600;">Введите параметры для расчета</div>
          <div style="font-size: 14px; margin-top: 10px;">Нажмите "Рассчитать расход" для получения результатов</div>
        </div>
      `;
      
      document.getElementById('calcResultStatus').textContent = 'Ожидание расчета';
      document.getElementById('calcResultStatus').className = 'status-badge status-info';
      
      document.getElementById('detailedCalculation').classList.add('hidden');
      document.getElementById('packingInfo').classList.add('hidden');
      document.getElementById('technicalInfo').classList.add('hidden');
      
      showNotification('Калькулятор очищен', 'success');
    }

    // ========== ФУНКЦИИ ДЛЯ ПРОВЕРКИ УСЛОВИЙ ==========
    function updateProductOptions() {
      const category = currentCategory;
      const products = PRODUCTS_BY_CATEGORY[category] || [];
      const productDropdown = document.getElementById('product-dropdown');
      const productBtn = document.getElementById('product-btn');
      const productHint = document.getElementById('product-hint');
      
      productDropdown.innerHTML = '';
      
      if (products.length === 0) {
        const emptyOption = document.createElement('div');
        emptyOption.className = 'custom-select-option';
        emptyOption.textContent = 'Нет продуктов для выбранной категории';
        productDropdown.appendChild(emptyOption);
        return;
      }
      
      products.forEach((product, index) => {
        const option = document.createElement('div');
        option.className = 'custom-select-option';
        option.setAttribute('data-value', product.id);
        option.textContent = product.name;
        
        if (index === 0) {
          option.classList.add('selected');
          currentProduct = product.id;
          productBtn.querySelector('#product-value').textContent = product.name;
        }
        
        option.addEventListener('click', function() {
          const value = this.getAttribute('data-value');
          const text = this.textContent;
          currentProduct = value;
          document.getElementById('product-value').textContent = text;
          
          productDropdown.querySelectorAll('.custom-select-option').forEach(opt => opt.classList.remove('selected'));
          this.classList.add('selected');
          
          closeAllDropdowns();
        });
        
        productDropdown.appendChild(option);
      });
      
      if (productHint && CATEGORY_HINTS[category]) {
        productHint.innerHTML = `<i class="fas fa-lightbulb"></i> ${CATEGORY_HINTS[category]}`;
      }
    }

    function initCustomSelects() {
      const categoryBtn = document.getElementById('category-btn');
      const categoryDropdown = document.getElementById('category-dropdown');
      const categoryOptions = categoryDropdown.querySelectorAll('.custom-select-option');
      
      const productBtn = document.getElementById('product-btn');
      const productDropdown = document.getElementById('product-dropdown');
      
      const surfaceBtn = document.getElementById('surface-btn');
      const surfaceDropdown = document.getElementById('surface-dropdown');
      const surfaceOptions = surfaceDropdown.querySelectorAll('.custom-select-option');
      
      const timerProductBtn = document.getElementById('timerProduct-btn');
      const timerProductDropdown = document.getElementById('timerProduct-dropdown');
      const timerProductOptions = timerProductDropdown.querySelectorAll('.custom-select-option');
      
      const fireResistanceBtn = document.getElementById('fireResistance-btn');
      const fireResistanceDropdown = document.getElementById('fireResistance-dropdown');
      const fireResistanceOptions = fireResistanceDropdown.querySelectorAll('.custom-select-option');
      
      document.addEventListener('click', function(e) {
        if (!e.target.closest('.custom-select')) {
          closeAllDropdowns();
        }
      });
      
      categoryBtn.addEventListener('click', function(e) {
        e.stopPropagation();
        toggleDropdown(categoryDropdown, categoryBtn);
      });
      
      categoryOptions.forEach(option => {
        option.addEventListener('click', function() {
          const value = this.getAttribute('data-value');
          const text = this.textContent;
          currentCategory = value;
          document.getElementById('category-value').textContent = text;
          
          categoryOptions.forEach(opt => opt.classList.remove('selected'));
          this.classList.add('selected');
          
          closeAllDropdowns();
          updateProductOptions();
        });
      });
      
      surfaceBtn.addEventListener('click', function(e) {
        e.stopPropagation();
        toggleDropdown(surfaceDropdown, surfaceBtn);
      });
      
      surfaceOptions.forEach(option => {
        option.addEventListener('click', function() {
          const value = this.getAttribute('data-value');
          const text = this.textContent;
          currentSurface = value;
          document.getElementById('surface-value').textContent = text;
          
          surfaceOptions.forEach(opt => opt.classList.remove('selected'));
          this.classList.add('selected');
          
          closeAllDropdowns();
        });
      });
      
      timerProductBtn.addEventListener('click', function(e) {
        e.stopPropagation();
        toggleDropdown(timerProductDropdown, timerProductBtn);
      });
      
      timerProductOptions.forEach(option => {
        option.addEventListener('click', function() {
          const value = this.getAttribute('data-value');
          const text = this.textContent;
          currentTimerProduct = value;
          document.getElementById('timerProduct-value').textContent = text;
          
          timerProductOptions.forEach(opt => opt.classList.remove('selected'));
          this.classList.add('selected');
          
          closeAllDropdowns();
          updateTimerProductInfo();
        });
      });
      
      fireResistanceBtn.addEventListener('click', function(e) {
        e.stopPropagation();
        toggleDropdown(fireResistanceDropdown, fireResistanceBtn);
      });
      
      fireResistanceOptions.forEach(option => {
        option.addEventListener('click', function() {
          const value = this.getAttribute('data-value');
          const text = this.textContent;
          currentFireResistance = value;
          document.getElementById('fireResistance-value').textContent = text;
          
          fireResistanceOptions.forEach(opt => opt.classList.remove('selected'));
          this.classList.add('selected');
          
          closeAllDropdowns();
        });
      });
    }

    function toggleDropdown(dropdown, btn) {
      const isOpen = dropdown.classList.contains('open');
      closeAllDropdowns();
      
      if (!isOpen) {
        dropdown.classList.add('open');
        btn.classList.add('open');
      }
    }

    function closeAllDropdowns() {
      document.querySelectorAll('.custom-select-dropdown').forEach(dropdown => {
        dropdown.classList.remove('open');
      });
      document.querySelectorAll('.custom-select-btn').forEach(btn => {
        btn.classList.remove('open');
      });
    }

    function switchTab(tabName) {
      document.querySelectorAll('.tab-content').forEach(tab => {
        tab.classList.remove('active');
      });
      
      document.querySelectorAll('.tab').forEach(tab => {
        tab.classList.remove('active');
      });
      
      document.getElementById(tabName).classList.add('active');
      event.currentTarget.classList.add('active');
      
      if (tabName === 'timer') {
        updateTimerProductInfo();
      }
      
      if (tabName === 'history') {
        loadHistory();
      }
      
      if (tabName === 'check') {
        updateProductOptions();
      }
      
      if (tabName === 'calculator') {
        if (currentCalcTab === 'manual') {
          updateAreaFromLength();
        }
      }
      
      closeAllDropdowns();
    }

    function runAssistant() {
      incompatibleDetected = false;
      clearErrors();
      
      const productId = currentProduct;
      const temp = parseFloat(document.getElementById("temp").value);
      const humidity = parseFloat(document.getElementById("humidity").value);
      const surface = currentSurface;
      const areaStr = document.getElementById("area2").value;
      const area = areaStr ? parseFloat(areaStr) : null;

      if (!validateInputs()) {
        showNotification("Пожалуйста, проверьте введенные данные", "error");
        return;
      }

      const prod = PRODUCTS[productId];
      let messages = [];
      let severity = "ok";
      let showSupportCTA = false;
      let compatibilityScore = 100;

      if (temp < prod.minTemp) {
        messages.push({
          text: `❌ <b>Температура ниже допустимой!</b><br>Минимум: ${prod.minTemp}°C. Нанесение запрещено.`,
          type: "error"
        });
        severity = "error";
        showSupportCTA = true;
        compatibilityScore -= 30;
      } else if (temp > prod.maxTemp) {
        messages.push({
          text: `⚠️ <b>Температура выше допустимой!</b><br>Максимум: ${prod.maxTemp}°C. Нанесение не рекомендуется.`,
          type: "warning"
        });
        if (severity !== "error") severity = "warning";
        showSupportCTA = true;
        compatibilityScore -= 20;
      } else if (temp > 30) {
        messages.push({
          text: `⚠️ <b>Температура выше оптимальной</b><br>Рекомендуется: до 30°C. Возможно ускоренное высыхание.`,
          type: "warning"
        });
        if (severity !== "error") severity = "warning";
        compatibilityScore -= 10;
      } else if (temp >= prod.minTemp && temp <= 30) {
        messages.push({
          text: `✅ <b>Температура в норме</b><br>${temp}°C соответствует требованиям.`,
          type: "success"
        });
      }

      if (humidity > prod.maxHumidity) {
        messages.push({
          text: `❌ <b>Влажность превышена!</b><br>Максимум: ${prod.maxHumidity}%. Возможна потеря адгезии.`,
          type: "error"
        });
        severity = "error";
        showSupportCTA = true;
        compatibilityScore -= 30;
      } else if (humidity > 75) {
        messages.push({
          text: `⚠️ <b>Высокая влажность</b><br>Рекомендуется: до 75%. Контролируйте точку росы.`,
          type: "warning"
        });
        compatibilityScore -= 10;
      } else if (humidity <= prod.maxHumidity) {
        messages.push({
          text: `✅ <b>Влажность в норме</b><br>${humidity}% соответствует требованиям.`,
          type: "success"
        });
      }

      if (prod.compatibility) {
        const compat = prod.compatibility[surface];
        if (compat === false) {
          messages.push({
            text: `❌ <b>НЕСОВМЕСТИМО!</b><br>Нанесение по "${SURFACE_LABELS[surface]}" <u>запрещено</u> согласно ТУ.`,
            type: "error"
          });
          severity = "error";
          showSupportCTA = true;
          compatibilityScore -= 40;
          incompatibleDetected = true;
        } else if (compat === true) {
          messages.push({
            text: `✅ <b>Совместимо</b><br>"${SURFACE_LABELS[surface]}" — допустимая поверхность.`,
            type: "success"
          });
        } else {
          messages.push({
            text: `ℹ️ Совместимость не подтверждена.<br>Рекомендуем согласовать с техническим отделом.`,
            type: "info"
          });
          showSupportCTA = true;
          compatibilityScore -= 20;
        }
      }

      if (severity === "ok") {
        messages.unshift({
          text: `✅ <b>Условия нанесения соблюдены</b><br>Можно приступать к работе с ${prod.name}.`,
          type: "success"
        });
        showNotification("Проверка завершена успешно! Условия соблюдены.", "success");
      } else if (severity === "warning") {
        messages.unshift({
          text: `⚠️ <b>Требуется внимание</b><br>Имеются незначительные нарушения условий.`,
          type: "warning"
        });
        showNotification("Есть незначительные нарушения условий", "warning");
      } else {
        messages.unshift({
          text: `❌ <b>Нанесение запрещено</b><br>Условия не соответствуют требованиям.`,
          type: "error"
        });
        showNotification("Нанесение запрещено! Условия не соблюдены.", "error");
      }
      
      let infoCardsHTML = `
        <div class="info-cards">
          <div class="info-card">
            <div class="info-card-title">
              <i class="fas fa-temperature-low"></i>Температура
            </div>
            <div class="info-card-value">${temp}°C</div>
            <div class="info-card-unit">${temp >= prod.minTemp && temp <= prod.maxTemp ? '✓ В норме' : '✗ Не в норме'}</div>
          </div>
          
          <div class="info-card">
            <div class="info-card-title">
              <i class="fas fa-tint"></i>Влажность
            </div>
            <div class="info-card-value">${humidity}%</div>
            <div class="info-card-unit">${humidity <= prod.maxHumidity ? '✓ В норме' : '✗ Выше нормы'}</div>
          </div>
          
          <div class="info-card">
            <div class="info-card-title">
              <i class="fas fa-paint-roller"></i>Продукт
            </div>
            <div class="info-card-value">${prod.name}</div>
            <div class="info-card-unit">${prod.type}</div>
          </div>
        </div>
      `;

      let fireResistanceHTML = '';
      if (prod.consumption) {
        fireResistanceHTML = `<div class="result-item info">
          <div class="mb-10"><i class="fas fa-fire"></i> <b>Огнезащитные характеристики:</b></div>`;
        
        if (prod.consumption.R30) {
          fireResistanceHTML += `<div class="mb-10">• <b>R30:</b> толщина ${prod.consumption.R30.thickness} мм, расход ${prod.consumption.R30.consumption} кг/м²</div>`;
          if (area) {
            const totalKg = (prod.consumption.R30.consumption * area).toFixed(1);
            fireResistanceHTML += `<div>• <b>На ${area} м² для R30:</b> потребуется ${totalKg} кг материала</div>`;
          }
        }
        
        if (prod.consumption.R60) {
          fireResistanceHTML += `<div class="mb-10">• <b>R60:</b> толщина ${prod.consumption.R60.thickness} мм, расход ${prod.consumption.R60.consumption} кг/м²</div>`;
          if (area) {
            const totalKg = (prod.consumption.R60.consumption * area).toFixed(1);
            fireResistanceHTML += `<div>• <b>На ${area} м² для R60:</b> потребуется ${totalKg} кг материала</div>`;
          }
        }
        
        if (prod.consumption.R90) {
          fireResistanceHTML += `<div class="mb-10">• <b>R90:</b> толщина ${prod.consumption.R90.thickness} мм, расход ${prod.consumption.R90.consumption} кг/м²</div>`;
          if (area) {
            const totalKg = (prod.consumption.R90.consumption * area).toFixed(1);
            fireResistanceHTML += `<div>• <b>На ${area} м² для R90:</b> потребуется ${totalKg} кг материала</div>`;
          }
        }
        
        if (prod.consumption.R120) {
          fireResistanceHTML += `<div class="mb-10">• <b>R120:</b> толщина ${prod.consumption.R120.thickness} мм, расход ${prod.consumption.R120.consumption} кг/м²</div>`;
          if (area) {
            const totalKg = (prod.consumption.R120.consumption * area).toFixed(1);
            fireResistanceHTML += `<div>• <b>На ${area} м² для R120:</b> потребуется ${totalKg} кг материала</div>`;
          }
        }
        
        if (prod.consumption.standard) {
          fireResistanceHTML += `<div class="mb-10">• <b>Стандартный расход:</b> ${prod.consumption.standard.consumption} кг/м²</div>`;
          if (area) {
            const totalKg = (prod.consumption.standard.consumption * area).toFixed(1);
            fireResistanceHTML += `<div>• <b>На ${area} м²:</b> потребуется ${totalKg} кг материала</div>`;
          }
        }
        
        fireResistanceHTML += `</div>`;
      }

      let materialHTML = '';
      if (area) {
        materialHTML = `<div class="result-item success">
          <div class="mb-10"><i class="fas fa-calculator"></i> <b>Расчет материала:</b></div>`;
        
        if (prod.isSystem && prod.consumption.R60) {
          const totalConsumption = prod.consumption.R60.totalConsumption;
          const totalKg = (totalConsumption * area).toFixed(1);
          
          materialHTML += `<div class="mb-10">• <b>Общий расход системы:</b> ${totalConsumption} кг/м²</div>`;
          materialHTML += `<div class="mb-10">• <b>На ${area} м²:</b> ${totalKg} кг материала</div>`;
          
          if (prod.consumption.R60.components) {
            materialHTML += `<div class="mt-10"><b>Детализация по компонентам:</b></div>`;
            for (const [comp, data] of Object.entries(prod.consumption.R60.components)) {
              const compName = comp === 'vm' ? 'Спец-ВМ' : 'Спец-Конструктив';
              const compKg = (data.consumption * area).toFixed(1);
              materialHTML += `<div>• ${compName}: ${data.consumption} кг/м² × ${area} м² = <b>${compKg} кг</b></div>`;
            }
          }
        } else if (prod.consumption) {
          let consumptionData = null;
          
          if (prod.consumption.R60) {
            consumptionData = prod.consumption.R60;
          } else if (prod.consumption.standard) {
            consumptionData = prod.consumption.standard;
          }
          
          if (consumptionData) {
            const consumption = consumptionData.consumption;
            const totalKg = (consumption * area).toFixed(1);
            materialHTML += `<div class="mb-10">• <b>Расход:</b> ${consumption} кг/м²</div>`;
            materialHTML += `<div class="mb-10">• <b>На ${area} м²:</b> ${consumption} кг/м² × ${area} м² = <b>${totalKg} кг</b></div>`;
            
            if (prod.packaging) {
              let bucket25 = null;
              for (const [key, pack] of Object.entries(prod.packaging)) {
                if (pack.weight === 25) {
                  bucket25 = pack;
                  break;
                }
              }
              
              if (bucket25) {
                const buckets = Math.ceil(totalKg / bucket25.weight);
                materialHTML += `<div>• <b>Требуется ведер по 25 кг:</b> ${buckets} шт. (${(buckets * bucket25.weight).toFixed(1)} кг)</div>`;
              }
            }
          }
        }
        
        materialHTML += `<div class="mt-10"><i class="fas fa-info-circle"></i> <small>Для точного расчета перейдите в раздел "Калькулятор расхода"</small></div>`;
        materialHTML += `</div>`;
      }

      const season = getCurrentSeason();
      const seasonTip = getSeasonRecommendation(season);
      let seasonHTML = '';
      if (seasonTip) {
        seasonHTML = `<div class="hint-box">
          <i class="fas fa-calendar-alt"></i> <b>Сезонная рекомендация (${season}):</b> ${seasonTip}
        </div>`;
      }

      let supportHTML = '';
      if (showSupportCTA) {
        supportHTML = `<div class="result-item warning">
          <div><i class="fas fa-phone"></i> <b>Обратитесь к нашим инженерам!</b></div>
          <div class="mt-10">Мы подберём решение под ваш объект, проведём испытания совместимости и вышлем техническое заключение в течение 24 часов.</div>
          <div class="mt-10"><i class="fas fa-phone"></i> +7 (383) 375-90-07 | <i class="fas fa-envelope"></i> nz-ck@mail.ru</div>
        </div>`;
      }

      updateResultsUI(messages, severity, compatibilityScore, infoCardsHTML, fireResistanceHTML, seasonHTML, supportHTML, materialHTML);
      saveToHistory(prod, temp, humidity, surface, area, severity);
      
      lastCalculation = {
        date: new Date().toLocaleString('ru-RU'),
        product: prod.name,
        type: prod.type,
        temp: temp,
        humidity: humidity,
        surface: SURFACE_LABELS[surface],
        area: area,
        severity: severity,
        compatibilityScore: compatibilityScore,
        messages: messages,
        consumption: prod.consumption || null,
        packaging: prod.packaging || null
      };
    }

    function updateResultsUI(messages, severity, compatibilityScore, infoCardsHTML, fireResistanceHTML, seasonHTML, supportHTML, materialHTML) {
      const resultMessages = document.getElementById("resultMessages");
      const resultStatus = document.getElementById("resultStatus");
      const compatibilitySection = document.getElementById("compatibilitySection");
      const incompatibleWarning = document.getElementById("incompatibleWarning");
      const fireResistanceSection = document.getElementById("fireResistanceSection");
      const seasonAdvice = document.getElementById("seasonAdvice");
      const supportSection = document.getElementById("supportSection");
      const materialCalculation = document.getElementById("materialCalculation");
      
      let statusText = "Ожидание";
      let statusClass = "status-info";
      
      switch(severity) {
        case "ok":
          statusText = "✓ Готово";
          statusClass = "status-success";
          break;
        case "warning":
          statusText = "⚠️ Требует внимания";
          statusClass = "status-warning";
          break;
        case "error":
          statusText = "✗ Запрещено";
          statusClass = "status-error";
          break;
      }
      
      resultStatus.textContent = statusText;
      resultStatus.className = `status-badge ${statusClass}`;
      
      let messagesHTML = '';
      messages.forEach(msg => {
        let itemClass = "result-item ";
        let iconClass = "result-icon ";
        
        switch(msg.type) {
          case "success":
            itemClass += "success";
            iconClass += "success";
            break;
          case "warning":
            itemClass += "warning";
            iconClass += "warning";
            break;
          case "error":
            itemClass += "error";
            iconClass += "error";
            break;
          default:
            itemClass += "";
            iconClass += "info";
        }
        
        messagesHTML += `<div class="${itemClass}">
          <div class="result-icon ${iconClass}">${msg.type === 'success' ? '✓' : msg.type === 'warning' ? '⚠' : msg.type === 'error' ? '✗' : 'i'}</div>
          ${msg.text}
        </div>`;
      });
      
      resultMessages.innerHTML = messagesHTML + infoCardsHTML;
      
      if (incompatibleDetected) {
        incompatibleWarning.classList.remove("hidden");
        incompatibleWarning.innerHTML = `
          <div style="display: flex; align-items: center; gap: 15px;">
            <i class="fas fa-exclamation-triangle" style="font-size: 24px; color: var(--danger);"></i>
            <div>
              <div style="font-weight: bold; font-size: 16px; color: var(--danger);">ВНИМАНИЕ: НЕСОВМЕСТИМОСТЬ!</div>
              <div style="margin-top: 5px; color: var(--nzsk-black);">Выбранный продукт НЕ СОВМЕСТИМ с указанной поверхностью.</div>
              <div style="margin-top: 5px; font-size: 14px; color: var(--nzsk-black);">Использование запрещено согласно техническим указаниям НЗСК.</div>
            </div>
          </div>
        `;
        
        setTimeout(() => {
          incompatibleWarning.scrollIntoView({ behavior: 'smooth', block: 'start' });
        }, 100);
      } else {
        incompatibleWarning.classList.add("hidden");
      }
      
      compatibilitySection.classList.remove("hidden");
      document.getElementById("compatibilityPercent").textContent = compatibilityScore + "%";
      document.getElementById("compatibilityBar").style.width = compatibilityScore + "%";
      
      if (fireResistanceHTML) {
        fireResistanceSection.innerHTML = fireResistanceHTML;
        fireResistanceSection.classList.remove("hidden");
      } else {
        fireResistanceSection.classList.add("hidden");
      }
      
      if (materialHTML) {
        materialCalculation.innerHTML = materialHTML;
        materialCalculation.classList.remove("hidden");
      } else {
        materialCalculation.classList.add("hidden");
      }
      
      if (seasonHTML) {
        seasonAdvice.innerHTML = seasonHTML;
        seasonAdvice.classList.remove("hidden");
      } else {
        seasonAdvice.classList.add("hidden");
      }
      
      if (supportHTML) {
        supportSection.innerHTML = supportHTML;
        supportSection.classList.remove("hidden");
      } else {
        supportSection.classList.add("hidden");
      }
      
      document.querySelector('.results-column').scrollTop = 0;
    }

    function validateInputs() {
      clearErrors();
      
      const temp = document.getElementById("temp").value;
      const humidity = document.getElementById("humidity").value;
      const area = document.getElementById("area2").value;
      
      let isValid = true;
      
      if (temp === '' || isNaN(temp) || temp < -50 || temp > 100) {
        showError("temp", "Введите корректную температуру (-50...+100°C)");
        isValid = false;
      }
      
      if (humidity === '' || isNaN(humidity) || humidity < 0 || humidity > 100) {
        showError("humidity", "Введите влажность 0-100%");
        isValid = false;
      }
      
      if (area !== '' && (isNaN(area) || parseFloat(area) <= 0)) {
        showError("area", "Площадь должна быть числом > 0");
        isValid = false;
      }
      
      return isValid;
    }

    function clearErrors() {
      document.querySelectorAll('.error-message').forEach(el => {
        el.textContent = '';
      });
      document.querySelectorAll('.form-control.error').forEach(el => {
        el.classList.remove('error');
      });
    }

    function showError(fieldId, message) {
      const field = document.getElementById(fieldId);
      const errorSpan = document.getElementById(`${fieldId}-error`);
      
      if (field) {
        field.classList.add('error');
      }
      
      if (errorSpan) {
        errorSpan.textContent = message;
      }
    }

    function getCurrentSeason() {
      const month = new Date().getMonth();
      return month >= 2 && month <= 4 ? 'весна' :
             month >= 5 && month <= 7 ? 'лето' :
             month >= 8 && month <= 10 ? 'осень' : 'зима';
    }

    function getSeasonRecommendation(season) {
      const tips = {
        'зима': 'Рекомендуем подогрев материала до +15°C перед нанесением',
        'лето': 'Избегайте нанесения в полуденную жару, оптимально утро/вечер',
        'осень': 'Контролируйте точку росы, особенно утром',
        'весна': 'Внимание к перепадам температуры днем/ночью'
      };
      return tips[season] || '';
    }

    function saveToHistory(prod, temp, humidity, surface, area, severity) {
      if (!area) return;
      
      const calculation = {
        date: new Date().toLocaleString('ru-RU'),
        product: prod.name,
        area: area,
        conditions: { 
          temp, 
          humidity, 
          surface: SURFACE_LABELS[surface] 
        },
        severity: severity
      };
      
      calculationHistory.unshift(calculation);
      if (calculationHistory.length > 10) calculationHistory.pop();
      localStorage.setItem('nzsk_history', JSON.stringify(calculationHistory));
    }

    function loadHistory() {
      const historyItems = document.getElementById("historyItems");
      const history = JSON.parse(localStorage.getItem('nzsk_history') || '[]');
      
      if (history.length === 0) {
        historyItems.innerHTML = `
          <div style="text-align: center; padding: 40px; color: var(--nzsk-gray-dark);">
            <i class="fas fa-history" style="font-size: 48px; margin-bottom: 15px; opacity: 0.3;"></i>
            <div style="font-size: 16px; font-weight: 600;">История проверок пуста</div>
            <div style="font-size: 14px; margin-top: 10px;">Выполните первую проверку условий</div>
          </div>
        `;
        return;
      }
      
      let html = '<h4 style="margin-bottom: 15px; color: var(--nzsk-black);">Последние проверки:</h4>';
      history.slice(0, 10).forEach(item => {
        let statusBadge = '';
        switch(item.severity) {
          case "ok":
            statusBadge = '<span class="status-badge status-success" style="font-size: 10px;">✓</span>';
            break;
          case "warning":
            statusBadge = '<span class="status-badge status-warning" style="font-size: 10px;">⚠</span>';
            break;
          case "error":
            statusBadge = '<span class="status-badge status-error" style="font-size: 10px;">✗</span>';
            break;
        }
        
        html += `
          <div class="history-item">
            <div class="history-date">
              <i class="far fa-calendar"></i> ${item.date}
              ${statusBadge}
            </div>
            <div class="history-product">
              <i class="fas fa-paint-roller"></i> ${item.product}
            </div>
            <div style="font-size: 14px; color: var(--nzsk-gray-dark); margin-top: 8px;">
              <i class="fas fa-thermometer-half"></i> ${item.conditions.temp}°C | 
              <i class="fas fa-tint"></i> ${item.conditions.humidity}% |
              <i class="fas fa-ruler"></i> ${item.area} м²
            </div>
          </div>
        `;
      });
      
      historyItems.innerHTML = html;
    }

    function clearHistory() {
      if (confirm('Вы уверены, что хотите очистить всю историю проверок?')) {
        localStorage.removeItem('nzsk_history');
        calculationHistory = [];
        loadHistory();
        showNotification("История очищена", "success");
      }
    }

    function exportHistory() {
      const history = JSON.parse(localStorage.getItem('nzsk_history') || '[]');
      if (history.length === 0) {
        showNotification("История проверок пуста", "warning");
        return;
      }
      
      let csv = 'Дата,Продукт,Температура (°C),Влажность (%),Площадь (м²),Поверхность,Статус\n';
      history.forEach(item => {
        let status = '';
        switch(item.severity) {
          case "ok": status = "Разрешено"; break;
          case "warning": status = "Требует внимания"; break;
          case "error": status = "Запрещено"; break;
        }
        
        csv += `"${item.date}","${item.product}",${item.conditions.temp},${item.conditions.humidity},${item.area},"${item.conditions.surface}","${status}"\n`;
      });
      
      const blob = new Blob([csv], {type: 'text/csv;charset=utf-8;'});
      const url = URL.createObjectURL(blob);
      const link = document.createElement('a');
      link.href = url;
      link.download = `История_проверок_НЗСК_${new Date().toISOString().slice(0,10)}.csv`;
      link.click();
      
      showNotification("История экспортирована в CSV", "success");
    }

    function updateTimerProductInfo() {
      const productId = currentTimerProduct;
      const temp = parseFloat(document.getElementById("timerTemp").value) || 20;
      const prod = PRODUCTS[productId];
      
      if (prod && prod.dryingTime) {
        let hours;
        if (typeof prod.dryingTime === 'function') {
          hours = prod.dryingTime(temp);
        } else {
          hours = prod.dryingTime;
        }
        document.getElementById("timerInfo").textContent = 
          `Продукт: ${prod.name} | Время сушки: ${hours} часов`;
        
        timerTotalSeconds = hours * 3600;
      } else {
        document.getElementById("timerInfo").textContent = "Выберите продукт и температуру";
      }
    }

    function startDryingTimer() {
      if (timerRunning) return;
      
      const productId = currentTimerProduct;
      const temp = parseFloat(document.getElementById("timerTemp").value) || 20;
      const prod = PRODUCTS[productId];
      
      if (!prod || !prod.dryingTime) {
        showNotification("Сначала выберите продукт для таймера", "warning");
        return;
      }
      
      let hours;
      if (typeof prod.dryingTime === 'function') {
        hours = prod.dryingTime(temp);
      } else {
        hours = prod.dryingTime;
      }
      timerTotalSeconds = hours * 3600;
      timerSeconds = timerTotalSeconds;
      timerRunning = true;
      
      document.getElementById("startTimerBtn").innerHTML = '<i class="fas fa-play"></i>Идет отсчет...';
      document.getElementById("startTimerBtn").disabled = true;
      
      timerInterval = setInterval(updateTimer, 1000);
      updateTimer();
      
      showNotification("Таймер сушки запущен", "success");
    }

    function updateTimer() {
      if (timerSeconds <= 0) {
        clearInterval(timerInterval);
        timerRunning = false;
        document.getElementById("timerClock").innerHTML = '<span style="color: var(--success);">✓ ГОТОВО</span>';
        document.getElementById("timerPercent").textContent = "100%";
        document.getElementById("timerProgress").style.width = "100%";
        document.getElementById("startTimerBtn").innerHTML = '<i class="fas fa-play"></i>Запустить таймер';
        document.getElementById("startTimerBtn").disabled = false;
        
        showNotification("Время сушки завершено! Можно наносить следующий слой.", "success");
        
        return;
      }
      
      const hours = Math.floor(timerSeconds / 3600);
      const minutes = Math.floor((timerSeconds % 3600) / 60);
      const seconds = timerSeconds % 60;
      
      document.getElementById("timerClock").textContent = 
        `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
      
      const percent = 100 - (timerSeconds / timerTotalSeconds * 100);
      document.getElementById("timerPercent").textContent = Math.round(percent) + "%";
      document.getElementById("timerProgress").style.width = percent + "%";
      
      timerSeconds--;
    }

    function resetTimer() {
      clearInterval(timerInterval);
      timerRunning = false;
      timerSeconds = 0;
      document.getElementById("timerClock").textContent = "--:--:--";
      document.getElementById("timerPercent").textContent = "0%";
      document.getElementById("timerProgress").style.width = "0%";
      document.getElementById("startTimerBtn").innerHTML = '<i class="fas fa-play"></i>Запустить таймер';
      document.getElementById("startTimerBtn").disabled = false;
      updateTimerProductInfo();
      
      showNotification("Таймер сброшен", "success");
    }

    function generateReport() {
      if (!lastCalculation) {
        showNotification("Сначала выполните проверку условий", "warning");
        return;
      }
      
      const prodName = lastCalculation.product;
      const temp = lastCalculation.temp;
      const humidity = lastCalculation.humidity;
      const surface = lastCalculation.surface;
      const area = lastCalculation.area || "не указана";
      const severity = lastCalculation.severity;
      const compatibilityScore = lastCalculation.compatibilityScore;
      
      let statusText = "";
      switch(severity) {
        case "ok": statusText = "✓ Условия соблюдены"; break;
        case "warning": statusText = "⚠ Требует внимания"; break;
        case "error": statusText = "✗ Запрещено"; break;
      }
      
      let reportText = "=".repeat(60) + "\n";
      reportText += "           ОТЧЕТ О ПРОВЕРКЕ УСЛОВИЙ НАНЕСЕНИЯ\n";
      reportText += "           Завод НЗСК - огнезащитные материалы\n";
      reportText += "=".repeat(60) + "\n\n";
      
      reportText += "ДАННЫЕ ПРОВЕРКИ:\n";
      reportText += "-".repeat(40) + "\n";
      reportText += `Дата проверки: ${lastCalculation.date}\n`;
      reportText += `Продукт: ${prodName}\n`;
      reportText += `Тип: ${lastCalculation.type}\n`;
      reportText += `Температура: ${temp}°C\n`;
      reportText += `Влажность: ${humidity}%\n`;
      reportText += `Поверхность: ${surface}\n`;
      reportText += `Площадь: ${area} м²\n`;
      reportText += `Совместимость: ${compatibilityScore}%\n`;
      reportText += `Статус: ${statusText}\n\n`;
      
      reportText += "РЕЗУЛЬТАТЫ ПРОВЕРКИ:\n";
      reportText += "-".repeat(40) + "\n";
      
      lastCalculation.messages.forEach(msg => {
        let cleanText = msg.text.replace(/<[^>]*>/g, '');
        cleanText = cleanText.replace(/❌|⚠️|✅|ℹ️/g, '');
        reportText += `• ${cleanText}\n`;
      });
      
      reportText += "\n";
      
      if (lastCalculation.consumption) {
        reportText += "РАСЧЕТ РАСХОДА МАТЕРИАЛА:\n";
        reportText += "-".repeat(40) + "\n";
        
        if (lastCalculation.consumption.R60) {
          reportText += `• R60: толщина ${lastCalculation.consumption.R60.thickness} мм, расход ${lastCalculation.consumption.R60.consumption} кг/м²\n`;
          if (area && area !== "не указана") {
            const totalKg = (lastCalculation.consumption.R60.consumption * area).toFixed(1);
            reportText += `  На ${area} м² потребуется ${totalKg} кг материала\n`;
          }
        }
        
        reportText += "\n";
      }
      
      const season = getCurrentSeason();
      const seasonTip = getSeasonRecommendation(season);
      if (seasonTip) {
        reportText += "СЕЗОННАЯ РЕКОМЕНДАЦИЯ:\n";
        reportText += "-".repeat(40) + "\n";
        reportText += `Сезон: ${season}\n`;
        reportText += `Рекомендация: ${seasonTip}\n\n`;
      }
      
      reportText += "КОНТАКТЫ ТЕХНИЧЕСКОЙ ПОДДЕРЖКИ:\n";
      reportText += "-".repeat(40) + "\n";
      reportText += "Телефон: +7 (383) 375-90-07\n";
      reportText += "Email: nz-ck@mail.ru\n";
      reportText += "Сайт: https://nzck.ru/\n\n";
      
      reportText += "=".repeat(60) + "\n";
      reportText += "Отчет сгенерирован автоматически в Инженерном помощнике НЗСК\n";
      reportText += "Данный отчет является предварительным. Для точных расчетов\n";
      reportText += "обратитесь к техническим специалистам НЗСК.\n";
      reportText += "=".repeat(60);
      
      const blob = new Blob([reportText], {type: "text/plain;charset=utf-8"});
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = `Отчет_НЗСК_${prodName}_${new Date().toISOString().slice(0,10)}.txt`;
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);
      URL.revokeObjectURL(url);
      
      showNotification("Отчет успешно экспортирован", "success");
    }

    function clearForm() {
      document.getElementById("temp").value = "20";
      document.getElementById("humidity").value = "60";
      document.getElementById("area2").value = "";
      clearErrors();
      
      currentCategory = "metal";
      currentProduct = "vm";
      currentSurface = "clean_metal";
      currentTimerProduct = "vm";
      currentFireResistance = "R60";
      
      document.getElementById("category-value").textContent = "Металлические конструкции";
      document.getElementById("product-value").textContent = "Спец-ВМ (металл, R15–R120)";
      document.getElementById("surface-value").textContent = "Чистый металл (без ржавчины и ЛКМ)";
      document.getElementById("timerProduct-value").textContent = "Спец-ВМ (металл, R15–R120)";
      document.getElementById("fireResistance-value").textContent = "R60 (60 минут)";
      
      document.querySelectorAll('.custom-select-option').forEach(option => {
        option.classList.remove('selected');
      });
      
      document.querySelector('#category-dropdown .custom-select-option[data-value="metal"]').classList.add('selected');
      document.querySelector('#surface-dropdown .custom-select-option[data-value="clean_metal"]').classList.add('selected');
      document.querySelector('#timerProduct-dropdown .custom-select-option[data-value="vm"]').classList.add('selected');
      document.querySelector('#fireResistance-dropdown .custom-select-option[data-value="R60"]').classList.add('selected');
      
      document.getElementById("resultMessages").innerHTML = `
        <div class="text-center" style="padding: 40px 20px; color: var(--nzsk-gray-dark);">
          <i class="fas fa-clipboard-list" style="font-size: 48px; margin-bottom: 15px; opacity: 0.3;"></i>
          <div style="font-size: 16px; font-weight: 600;">Введите данные для проверки</div>
          <div style="font-size: 14px; margin-top: 10px;">Нажмите "Проверить совместимость" для расчета</div>
        </div>
      `;
      
      document.getElementById("resultStatus").textContent = "Ожидание данных";
      document.getElementById("resultStatus").className = "status-badge status-info";
      
      document.getElementById("compatibilitySection").classList.add("hidden");
      document.getElementById("incompatibleWarning").classList.add("hidden");
      document.getElementById("fireResistanceSection").classList.add("hidden");
      document.getElementById("seasonAdvice").classList.add("hidden");
      document.getElementById("supportSection").classList.add("hidden");
      document.getElementById("materialCalculation").classList.add("hidden");
      
      updateProductOptions();
      
      showNotification("Форма очищена", "success");
    }

    function showNotification(message, type) {
      const notification = document.getElementById("notification");
      notification.textContent = message;
      notification.className = `notification ${type}`;
      notification.classList.remove("hidden");
      
      setTimeout(() => {
        notification.classList.add("hidden");
      }, 3000);
    }

    document.getElementById('timerTemp').addEventListener('input', updateTimerProductInfo);
  </script>
</body>
</html>
